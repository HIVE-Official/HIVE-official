"use client";

import React, { useState } from 'react';
import { cn } from '../../lib/utils';
import { motion } from '../framer-motion-proxy';
import { 
  Home, Users, User, Zap, BookOpen, Calendar, 
  Search, Bell, Settings, Plus, ChevronDown,
  MapPin, Building, Coffee, Beaker
} from 'lucide-react';
import { Button } from '../../atomic/atoms/button-enhanced';
import { 
  useNavigation, 
  NavigationContainer, 
  NavigationBrand,
  type NavigationItem 
} from './hive-navigation-system';
import { HiveLogo, HiveGlyphOnly } from '../hive-logo';

// ============================================================================
// CAMPUS BAR - TOP NAVIGATION
// ============================================================================

export function CampusBar() {
  const { user, searchOpen, setSearchOpen } = useNavigation();
  const [builderMode, setBuilderMode] = useState(false);

  // Campus metaphor navigation items
  const campusAreas = [
    {
      id: 'feed',
      label: 'Feed',
      description: 'The quad where everyone gathers',
      icon: Coffee,
      href: '/feed',
      isActive: false
    },
    {
      id: 'spaces',
      label: 'Spaces', 
      description: 'Buildings you enter for focused work',
      icon: Building,
      href: '/spaces',
      isActive: false
    },
    {
      id: 'profile',
      label: 'Profile',
      description: 'Your dorm room - your personal space',
      icon: User,
      href: '/profile',
      isActive: false
    }
  ];

  return (
    <NavigationContainer
      className="sticky top-0 z-50 backdrop-blur-xl border-b"
      style={{
        backgroundColor: 'var(--hive-background-primary)',
        backdropFilter: 'blur(3) saturate(180%)',
        borderColor: 'var(--hive-border-primary)',
      }}
    >
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div className="flex justify-between items-center h-16">
          
          {/* Left: HIVE Logo */}
          <NavigationBrand
            logo={<HiveLogo size="md" variant="gold" />}
            href="/"
            className="mr-8"
          />

          {/* Center: Campus Areas Navigation */}
          <div className="flex items-center space-x-1">
            {campusAreas.map((area) => {
              const Icon = area.icon;
              return (
                <motion.button
                  key={area.id}
                  className={cn(
                    "flex items-center gap-2 px-4 py-2 rounded-2xl transition-all duration-200",
                    "hover:bg-[var(--hive-interactive-hover)]",
                    area.isActive && "bg-[var(--hive-overlay-gold-subtle)] text-[var(--hive-brand-primary)]"
                  )}
                  style={{
                    color: area.isActive ? 'var(--hive-brand-primary)' : 'var(--hive-text-primary)'
                  }}
                  whileHover={{ scale: 1.02 }}
                  whileTap={{ scale: 0.98 }}
                >
                  <Icon className="w-4 h-4" />
                  <span className="font-medium">{area.label}</span>
                </motion.button>
              );
            }}
          </div>

          {/* Right: Builder Toggle + User Actions */}
          <div className="flex items-center space-x-4">
            
            {/* HiveLAB Builder Toggle */}
            <motion.button
              onClick={() => setBuilderMode(!builderMode)}
              className={cn(
                "flex items-center gap-2 px-3 py-2 rounded-2xl border transition-all duration-300",
                builderMode 
                  ? "bg-[var(--hive-brand-primary)] text-[var(--hive-text-inverse)] border-[var(--hive-brand-primary)]"
                  : "bg-[var(--hive-background-secondary)] text-[var(--hive-text-primary)] border-[var(--hive-border-primary)] hover:border-[var(--hive-brand-primary)]"
              )}
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
            >
              <Beaker className="w-4 h-4" />
              <span className="font-medium text-sm">HiveLAB</span>
              {!builderMode && (
                <motion.div
                  className="w-2 h-2 rounded-full"
                  style={{ backgroundColor: 'var(--hive-brand-primary)' }}
                  animate={{ opacity: [1, 0.5, 1] }}
                  transition={{ duration: 1.5, repeat: Infinity }}
                />
              )}
            </motion.button>

            {/* Search */}
            <Button
              variant="ghost"
              size="sm"
              onClick={() => setSearchOpen(true)}
              className="text-[var(--hive-text-primary)] hover:bg-[var(--hive-interactive-hover)]"
            >
              <Search className="w-4 h-4" />
            </Button>

            {/* Notifications */}
            <Button
              variant="ghost"
              size="sm"
              className="relative text-[var(--hive-text-primary)] hover:bg-[var(--hive-interactive-hover)]"
            >
              <Bell className="w-4 h-4" />
              <motion.div
                className="absolute -top-1 -right-1 w-3 h-3 rounded-full"
                style={{ backgroundColor: 'var(--hive-status-error)' }}
                animate={{ scale: [1, 1.2, 1] }}
                transition={{ duration: 2, repeat: Infinity }}
              />
            </Button>

            {/* User Menu */}
            {user && (
              <Button
                variant="ghost"
                size="sm"
                className="flex items-center space-x-2 text-[var(--hive-text-primary)] hover:bg-[var(--hive-interactive-hover)]"
              >
                <div
                  className="w-8 h-8 rounded-full flex items-center justify-center"
                  style={{ backgroundColor: 'var(--hive-background-secondary)' }}
                >
                  {user.avatar ? (
                    <img src={user.avatar} alt={user.name} className="w-8 h-8 rounded-full" />
                  ) : (
                    <User className="w-4 h-4" />
                  )}
                </div>
                <span className="hidden sm:block text-sm font-medium">
                  {user.name.split(' ')[0]}
                </span>
                <ChevronDown className="w-3 h-3" />
              </Button>
            )}
          </div>
        </div>
      </div>
    </NavigationContainer>
  );
}

// ============================================================================
// CONTEXT BREADCRUMBS - SPATIAL AWARENESS
// ============================================================================

interface BreadcrumbItem {
  id: string;
  label: string;
  href?: string;
  icon?: React.ComponentType<{ className?: string }>;
}

interface ContextBreadcrumbsProps {
  items: BreadcrumbItem[];
  className?: string;
}

export function ContextBreadcrumbs({ items, className }: ContextBreadcrumbsProps) {
  return (
    <nav className={cn("flex items-center space-x-2 text-sm", className)}>
      <MapPin 
        className="w-4 h-4" 
        style={{ color: 'var(--hive-text-muted)' }}
      />
      
      {items.map((item, index) => {
        const Icon = item.icon;
        const isLast = index === items.length - 1;
        
        return (
          <React.Fragment key={item.id}>
            <div className="flex items-center gap-1">
              {Icon && <Icon className="w-3 h-3" />}
              {item.href ? (
                <a
                  href={item.href}
                  className="hover:text-[var(--hive-brand-primary)] transition-colors"
                  style={{ 
                    color: isLast ? 'var(--hive-text-primary)' : 'var(--hive-text-muted)'
                  }}
                >
                  {item.label}
                </a>
              ) : (
                <span
                  style={{ 
                    color: isLast ? 'var(--hive-text-primary)' : 'var(--hive-text-muted)'
                  }}
                >
                  {item.label}
                </span>
              )}
            </div>
            
            {!isLast && (
              <span style={{ color: 'var(--hive-text-muted)' }}>
                /
              </span>
            )}
          </React.Fragment>
        );
      }}
    </nav>
  );
}

// ============================================================================
// SIX SURFACES TAB BAR - SPACE NAVIGATION
// ============================================================================

interface Surface {
  id: string;
  label: string;
  icon: React.ComponentType<{ className?: string }>;
  count?: number;
  isActive?: boolean;
}

interface SixSurfacesTabBarProps {
  surfaces: Surface[];
  onSurfaceChange?: (surfaceId: string) => void;
  className?: string;
}

export function SixSurfacesTabBar({ 
  surfaces, 
  onSurfaceChange, 
  className 
}: SixSurfacesTabBarProps) {
  return (
    <div 
      className={cn(
        "flex items-center space-x-1 p-1 rounded-2xl border backdrop-blur-sm",
        className
      )}
      style={{
        backgroundColor: 'var(--hive-background-secondary)',
        borderColor: 'var(--hive-border-primary)'
      }}
    >
      {surfaces.map((surface) => {
        const Icon = surface.icon;
        
        return (
          <motion.button
            key={surface.id}
            onClick={() => onSurfaceChange?.(surface.id)}
            className={cn(
              "flex items-center gap-2 px-3 py-2 rounded-xl transition-all duration-200 relative",
              surface.isActive
                ? "bg-[var(--hive-brand-primary)] text-[var(--hive-text-inverse)]"
                : "text-[var(--hive-text-primary)] hover:bg-[var(--hive-interactive-hover)]"
            )}
            whileHover={{ scale: 1.02 }}
            whileTap={{ scale: 0.98 }}
          >
            <Icon className="w-4 h-4" />
            <span className="font-medium text-sm">{surface.label}</span>
            
            {surface.count && surface.count > 0 && (
              <span
                className="px-2 py-1 text-xs rounded-full font-medium"
                style={{
                  backgroundColor: surface.isActive 
                    ? 'var(--hive-background-primary)' 
                    : 'var(--hive-background-tertiary)',
                  color: surface.isActive 
                    ? 'var(--hive-text-primary)' 
                    : 'var(--hive-text-muted)'
                }}
              >
                {surface.count}
              </span>
            )}
          </motion.button>
        );
      }}
    </div>
  );
}

// ============================================================================
// CAMPUS LAYOUT SHELL
// ============================================================================

interface CampusLayoutShellProps {
  children: React.ReactNode;
  breadcrumbs?: BreadcrumbItem[];
  surfaces?: Surface[];
  onSurfaceChange?: (surfaceId: string) => void;
  className?: string;
}

export function CampusLayoutShell({
  children,
  breadcrumbs,
  surfaces,
  onSurfaceChange,
  className
}: CampusLayoutShellProps) {
  return (
    <div className={cn("min-h-screen", className)}>
      {/* Campus Bar */}
      <CampusBar />
      
      {/* Context Layer */}
      {(breadcrumbs || surfaces) && (
        <div
          className="border-b px-4 sm:px-6 lg:px-8 py-3"
          style={{ borderColor: 'var(--hive-border-subtle)' }}
        >
          <div className="max-w-7xl mx-auto flex items-center justify-between">
            {/* Breadcrumbs */}
            {breadcrumbs && (
              <ContextBreadcrumbs items={breadcrumbs} />
            )}
            
            {/* Six Surfaces */}
            {surfaces && (
              <SixSurfacesTabBar 
                surfaces={surfaces}
                onSurfaceChange={onSurfaceChange}
              />
            )}
          </div>
        </div>
      )}
      
      {/* Main Content */}
      <main className="flex-1">
        {children}
      </main>
    </div>
  );
}
"use client";

import React, { useState } from 'react';
import { Button } from '../atomic/atoms';
import { 
  Target, 
  Compass, 
  UserPlus, 
  Sparkles, 
  ChevronRight, 
  Clock,
  Users,
  CheckCircle,
  Play,
  RotateCcw
} from 'lucide-react';

export interface RitualActionButtonProps {
  ritualType: 'initialize' | 'discover' | 'connect' | 'launch';
  actionType: 'start' | 'continue' | 'complete' | 'retry';
  progress?: number;
  isDisabled?: boolean;
  isLoading?: boolean;
  estimatedTime?: number;
  participantCount?: number;
  onClick?: () => void;
  className?: string;
}

const getRitualConfig = (ritualType: string) => {
  const configs = {
    initialize: {
      title: 'Initialize',
      description: 'Build your foundation',
      icon: Target,
      color: 'hive-gold',
      gradient: 'from-hive-gold to-yellow-500'
    },
    discover: {
      title: 'Discover',
      description: 'Find your communities',
      icon: Compass,
      color: 'hive-brand-secondary',
      gradient: 'from-hive-brand-secondary to-purple-500'
    },
    connect: {
      title: 'Connect',
      description: 'Build your network',
      icon: UserPlus,
      color: 'purple-400',
      gradient: 'from-purple-500 to-pink-500'
    },
    launch: {
      title: 'Launch',
      description: 'Prepare for campus',
      icon: Sparkles,
      color: 'green-400',
      gradient: 'from-green-500 to-blue-500'
    }
  };
  
  return configs[ritualType as keyof typeof configs] || configs.initialize;
};

const getActionConfig = (actionType: string) => {
  const configs = {
    start: {
      label: 'Start Ritual',
      icon: Play,
      description: 'Begin your journey'
    },
    continue: {
      label: 'Continue',
      icon: ChevronRight,
      description: 'Pick up where you left off'
    },
    complete: {
      label: 'Complete',
      icon: CheckCircle,
      description: 'Finish this ritual'
    },
    retry: {
      label: 'Try Again',
      icon: RotateCcw,
      description: 'Retry this ritual'
    }
  };
  
  return configs[actionType as keyof typeof configs] || configs.start;
};

export function RitualActionButton({
  ritualType,
  actionType,
  progress = 0,
  isDisabled = false,
  isLoading = false,
  estimatedTime,
  participantCount,
  onClick,
  className = ''
}: RitualActionButtonProps) {
  const [isHovered, setIsHovered] = useState(false);
  
  const ritualConfig = getRitualConfig(ritualType);
  const actionConfig = getActionConfig(actionType);
  
  const RitualIcon = ritualConfig.icon;
  const ActionIcon = actionConfig.icon;
  
  const handleClick = () => {
    if (!isDisabled && !isLoading) {
      onClick?.();
    }
  };

  return (
    <div 
      className={`relative ${className}`}
      onMouseEnter={() => setIsHovered(true)}
      onMouseLeave={() => setIsHovered(false)}
    >
      <Button
        onClick={handleClick}
        disabled={isDisabled || isLoading}
        className={`
          relative overflow-hidden transition-all duration-300 h-auto p-0
          ${isHovered ? 'scale-105 shadow-xl' : 'shadow-lg'}
          ${isDisabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}
        `}
      >
        {/* Background gradient */}
        <div className={`
          absolute inset-0 bg-gradient-to-r ${ritualConfig.gradient} 
          transition-opacity duration-300
          ${isHovered ? 'opacity-100' : 'opacity-90'}
        `} />
        
        {/* Progress overlay for continue/complete actions */}
        {(actionType === 'continue' || actionType === 'complete') && progress > 0 && (
          <div 
            className="absolute inset-0 bg-gradient-to-r from-white/20 to-transparent transition-all duration-300"
            style={{ width: `${progress}%` }}
          />
        )}
        
        {/* Content */}
        <div className="relative z-10 p-6 text-left w-full">
          <div className="flex items-center justify-between mb-4">
            <div className="flex items-center space-x-3">
              <div className="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center">
                <RitualIcon className="h-6 w-6 text-white" />
              </div>
              <div>
                <h3 className="text-lg font-bold text-white">
                  {ritualConfig.title}
                </h3>
                <p className="text-white/80 text-sm">
                  {ritualConfig.description}
                </p>
              </div>
            </div>
            
            <div className="flex items-center space-x-2">
              <ActionIcon className="h-5 w-5 text-white" />
              {isLoading && (
                <div className="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent" />
              )}
            </div>
          </div>
          
          {/* Progress bar for continue/complete actions */}
          {(actionType === 'continue' || actionType === 'complete') && (
            <div className="mb-4">
              <div className="flex items-center justify-between text-white/80 text-xs mb-2">
                <span>Progress</span>
                <span>{progress}% complete</span>
              </div>
              <div className="w-full bg-white/20 rounded-full h-2">
                <div 
                  className="bg-white rounded-full h-2 transition-all duration-500"
                  style={{ width: `${progress}%` }}
                />
              </div>
            </div>
          )}
          
          {/* Action label and meta info */}
          <div className="flex items-center justify-between">
            <div>
              <div className="text-white font-semibold">
                {actionConfig.label}
              </div>
              <div className="text-white/70 text-xs">
                {actionConfig.description}
              </div>
            </div>
            
            <div className="text-right">
              {estimatedTime && (
                <div className="flex items-center space-x-1 text-white/70 text-xs mb-1">
                  <Clock className="h-3 w-3" />
                  <span>~{estimatedTime}m</span>
                </div>
              )}
              {participantCount && (
                <div className="flex items-center space-x-1 text-white/70 text-xs">
                  <Users className="h-3 w-3" />
                  <span>{participantCount.toLocaleString()} active</span>
                </div>
              )}
            </div>
          </div>
        </div>
        
        {/* Shine effect on hover */}
        {isHovered && (
          <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent animate-pulse" />
        )}
      </Button>
      
      {/* Glow effect when hovered */}
      {isHovered && (
        <div className={`
          absolute inset-0 -z-10 bg-gradient-to-r ${ritualConfig.gradient} 
          rounded-lg blur-xl opacity-30 scale-110
        `} />
      )}
    </div>
  );
}
"use client";
import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useState } from 'react';
import { HiveCard as Card } from '../hive-card.js';
import { HiveButton as Button } from '../hive-button.js';
import { HiveBadge as Badge } from '../hive-badge.js';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '../ui/tabs.js';
import { BarChart, Bar, LineChart, Line, PieChart, Pie, Cell, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, AreaChart, Area } from 'recharts';
import { TrendingUp, Users, Clock, Star, Download, Zap, Eye, Target, Activity, RefreshCw, Share2 } from 'lucide-react';
import { cn } from '../../lib/utils.js';
const COLORS = ['var(--hive-brand-secondary)', 'var(--hive-status-success)', 'var(--hive-status-info)', 'var(--hive-status-info)', 'var(--hive-status-warning)', 'var(--hive-status-error)'];
const MetricCard = ({ title, value, change, icon: Icon, format = 'number', className }) => {
    const formatValue = (val) => {
        switch (format) {
            case 'percentage':
                return `${val.toFixed(1)}%`;
            case 'duration':
                const minutes = Math.floor(val / 60);
                const seconds = Math.floor(val % 60);
                return `${minutes}m ${seconds}s`;
            case 'currency':
                return `$${val.toLocaleString()}`;
            default:
                return val.toLocaleString();
        }
    };
    const isPositiveChange = change && change > 0;
    const isNegativeChange = change && change < 0;
    return (_jsx(Card, { className: cn("p-6 bg-[color-mix(in_srgb,var(--hive-interactive-hover)_40%,transparent)] border-[color-mix(in_srgb,var(--hive-interactive-active)_60%,transparent)]", className), children: _jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { children: [_jsx("p", { className: "text-sm text-[var(--hive-text-tertiary)] mb-1", children: title }), _jsx("p", { className: "text-2xl font-bold text-[var(--hive-text-primary)]", children: formatValue(value) }), change !== undefined && (_jsxs("div", { className: cn("flex items-center gap-1 text-sm mt-1", isPositiveChange ? "text-green-400" : isNegativeChange ? "text-red-400" : "text-[var(--hive-text-tertiary)]"), children: [_jsx(TrendingUp, { className: cn("h-3 w-3", isNegativeChange && "rotate-180") }), _jsxs("span", { children: [Math.abs(change).toFixed(1), "%"] })] }))] }), _jsx("div", { className: "w-12 h-12 bg-[var(--hive-brand-secondary)]/20 rounded-lg flex items-center justify-center", children: _jsx(Icon, { className: "h-6 w-6 text-[var(--hive-brand-secondary)]" }) })] }) }));
};
const CustomTooltip = ({ active, payload, label }) => {
    if (active && payload && payload.length) {
        return (_jsxs(Card, { className: "p-3 bg-[color-mix(in_srgb,var(--hive-background-primary)_90%,transparent)] border-[var(--hive-interactive-active)]", children: [_jsx("p", { className: "text-[var(--hive-text-primary)] text-sm font-medium mb-2", children: label }), payload.map((entry, index) => (_jsxs("div", { className: "flex items-center gap-2 text-sm", children: [_jsx("div", { className: "w-3 h-3 rounded-full", style: { backgroundColor: entry.color } }), _jsxs("span", { className: "text-[var(--hive-text-tertiary)]", children: [entry.dataKey, ":"] }), _jsx("span", { className: "text-[var(--hive-text-primary)] font-medium", children: entry.value })] }, index)))] }));
    }
    return null;
};
const UsageChart = ({ data }) => {
    return (_jsxs(Card, { className: "p-6 bg-[color-mix(in_srgb,var(--hive-interactive-hover)_40%,transparent)] border-[color-mix(in_srgb,var(--hive-interactive-active)_60%,transparent)]", children: [_jsx("h3", { className: "text-lg font-semibold text-[var(--hive-text-primary)] mb-6", children: "Usage Over Time" }), _jsx(ResponsiveContainer, { width: "100%", height: 300, children: _jsxs(AreaChart, { data: data, children: [_jsx(CartesianGrid, { strokeDasharray: "3 3", stroke: "var(--hive-interactive-active)" }), _jsx(XAxis, { dataKey: "date", stroke: "var(--hive-text-tertiary)", fontSize: 12, tickFormatter: (value) => new Date(value).toLocaleDateString() }), _jsx(YAxis, { stroke: "var(--hive-text-tertiary)", fontSize: 12 }), _jsx(Tooltip, { content: _jsx(CustomTooltip, {}) }), _jsx(Area, { type: "monotone", dataKey: "usage", stroke: "var(--hive-brand-secondary)", fill: "color-mix(in_srgb,var(--hive-brand-secondary)_20%,transparent)", strokeWidth: 2 }), _jsx(Area, { type: "monotone", dataKey: "uniqueUsers", stroke: "var(--hive-status-success)", fill: "color-mix(in_srgb,var(--hive-status-success)_20%,transparent)", strokeWidth: 2 })] }) })] }));
};
const ActionBreakdownChart = ({ data }) => {
    return (_jsxs(Card, { className: "p-6 bg-[color-mix(in_srgb,var(--hive-interactive-hover)_40%,transparent)] border-[color-mix(in_srgb,var(--hive-interactive-active)_60%,transparent)]", children: [_jsx("h3", { className: "text-lg font-semibold text-[var(--hive-text-primary)] mb-6", children: "Top Actions" }), _jsx(ResponsiveContainer, { width: "100%", height: 300, children: _jsxs(BarChart, { data: data.slice(0, 8), children: [_jsx(CartesianGrid, { strokeDasharray: "3 3", stroke: "var(--hive-interactive-active)" }), _jsx(XAxis, { dataKey: "action", stroke: "var(--hive-text-tertiary)", fontSize: 12, angle: -45, textAnchor: "end", height: 60 }), _jsx(YAxis, { stroke: "var(--hive-text-tertiary)", fontSize: 12 }), _jsx(Tooltip, { content: _jsx(CustomTooltip, {}) }), _jsx(Bar, { dataKey: "count", fill: "var(--hive-brand-secondary)", radius: [4, 4, 0, 0] })] }) })] }));
};
const UserTypeChart = ({ data }) => {
    return (_jsxs(Card, { className: "p-6 bg-[color-mix(in_srgb,var(--hive-interactive-hover)_40%,transparent)] border-[color-mix(in_srgb,var(--hive-interactive-active)_60%,transparent)]", children: [_jsx("h3", { className: "text-lg font-semibold text-[var(--hive-text-primary)] mb-6", children: "User Demographics" }), _jsx(ResponsiveContainer, { width: "100%", height: 300, children: _jsxs(PieChart, { children: [_jsx(Pie, { data: data, cx: "50%", cy: "50%", labelLine: false, label: ({ name, percentage }) => `${name} (${percentage}%)`, outerRadius: 80, fill: "var(--hive-status-info)", dataKey: "count", children: data.map((entry, index) => (_jsx(Cell, { fill: COLORS[index % COLORS.length] }, `cell-${index}`))) }), _jsx(Tooltip, { content: _jsx(CustomTooltip, {}) })] }) })] }));
};
const RetentionChart = ({ data }) => {
    const chartData = [
        { period: 'Day 1', retention: data.day1 },
        { period: 'Day 7', retention: data.day7 },
        { period: 'Day 30', retention: data.day30 }
    ];
    return (_jsxs(Card, { className: "p-6 bg-[color-mix(in_srgb,var(--hive-interactive-hover)_40%,transparent)] border-[color-mix(in_srgb,var(--hive-interactive-active)_60%,transparent)]", children: [_jsx("h3", { className: "text-lg font-semibold text-[var(--hive-text-primary)] mb-6", children: "User Retention" }), _jsx(ResponsiveContainer, { width: "100%", height: 300, children: _jsxs(LineChart, { data: chartData, children: [_jsx(CartesianGrid, { strokeDasharray: "3 3", stroke: "var(--hive-interactive-active)" }), _jsx(XAxis, { dataKey: "period", stroke: "var(--hive-text-tertiary)", fontSize: 12 }), _jsx(YAxis, { stroke: "var(--hive-text-tertiary)", fontSize: 12 }), _jsx(Tooltip, { content: _jsx(CustomTooltip, {}) }), _jsx(Line, { type: "monotone", dataKey: "retention", stroke: "var(--hive-brand-secondary)", strokeWidth: 3, dot: { fill: 'var(--hive-brand-secondary)', strokeWidth: 2, r: 4 } })] }) })] }));
};
const TopSpacesTable = ({ data }) => {
    return (_jsxs(Card, { className: "p-6 bg-[color-mix(in_srgb,var(--hive-interactive-hover)_40%,transparent)] border-[color-mix(in_srgb,var(--hive-interactive-active)_60%,transparent)]", children: [_jsx("h3", { className: "text-lg font-semibold text-[var(--hive-text-primary)] mb-6", children: "Top Spaces" }), _jsx("div", { className: "space-y-3", children: data.slice(0, 10).map((space, index) => (_jsxs("div", { className: "flex items-center justify-between p-3 bg-[color-mix(in_srgb,var(--hive-interactive-hover)_60%,transparent)] rounded-lg", children: [_jsxs("div", { className: "flex items-center gap-3", children: [_jsx("div", { className: "w-8 h-8 bg-[var(--hive-brand-secondary)]/20 rounded-lg flex items-center justify-center", children: _jsx("span", { className: "text-[var(--hive-brand-secondary)] font-bold text-sm", children: index + 1 }) }), _jsxs("div", { children: [_jsx("p", { className: "text-[var(--hive-text-primary)] font-medium", children: space.spaceName }), _jsxs("p", { className: "text-sm text-[var(--hive-text-tertiary)]", children: [space.users, " users"] })] })] }), _jsxs("div", { className: "text-right", children: [_jsx("p", { className: "text-[var(--hive-text-primary)] font-medium", children: space.usage }), _jsx("p", { className: "text-sm text-[var(--hive-text-tertiary)]", children: "interactions" })] })] }, space.spaceId))) })] }));
};
export const ToolAnalyticsDashboard = ({ toolId, toolName, analytics, onRefresh, onExport, className }) => {
    const [dateRange, setDateRange] = useState('30d');
    const [activeTab, setActiveTab] = useState('overview');
    if (!analytics) {
        return (_jsx("div", { className: cn("flex items-center justify-center h-64", className), children: _jsxs("div", { className: "text-center", children: [_jsx(Activity, { className: "h-12 w-12 text-[var(--hive-text-tertiary)] mx-auto mb-4" }), _jsx("p", { className: "text-[var(--hive-text-primary)] text-lg font-medium", children: "Loading Analytics..." }), _jsxs("p", { className: "text-[var(--hive-text-tertiary)]", children: ["Gathering insights for ", toolName] })] }) }));
    }
    return (_jsxs("div", { className: cn("space-y-8", className), children: [_jsxs("div", { className: "flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4", children: [_jsxs("div", { children: [_jsx("h1", { className: "text-3xl font-bold text-[var(--hive-text-primary)] mb-2", children: "Analytics Dashboard" }), _jsxs("p", { className: "text-[var(--hive-text-tertiary)]", children: [toolName, " \u2022 Last 30 days"] })] }), _jsxs("div", { className: "flex items-center gap-3", children: [_jsxs("select", { value: dateRange, onChange: (e) => setDateRange(e.target.value), className: "bg-[var(--hive-interactive-hover)] border border-[var(--hive-border-hover)] rounded-lg px-3 py-2 text-[var(--hive-text-primary)] text-sm", children: [_jsx("option", { value: "7d", children: "Last 7 days" }), _jsx("option", { value: "30d", children: "Last 30 days" }), _jsx("option", { value: "90d", children: "Last 90 days" }), _jsx("option", { value: "1y", children: "Last year" })] }), _jsxs(Button, { onClick: onRefresh, variant: "outline", size: "sm", className: "border-[var(--hive-border-hover)] text-[var(--hive-text-tertiary)]", children: [_jsx(RefreshCw, { className: "h-4 w-4 mr-2" }), "Refresh"] }), _jsxs(Button, { onClick: () => onExport?.('csv'), variant: "outline", size: "sm", className: "border-[var(--hive-border-hover)] text-[var(--hive-text-tertiary)]", children: [_jsx(Share2, { className: "h-4 w-4 mr-2" }), "Export"] })] })] }), _jsxs(Tabs, { value: activeTab, onValueChange: setActiveTab, className: "w-full", children: [_jsxs(TabsList, { className: "grid w-full grid-cols-4 bg-[var(--hive-interactive-hover)]", children: [_jsx(TabsTrigger, { value: "overview", className: "data-[state=active]:bg-[var(--hive-brand-secondary)] data-[state=active]:text-[var(--hive-background-primary)]", children: "Overview" }), _jsx(TabsTrigger, { value: "usage", className: "data-[state=active]:bg-[var(--hive-brand-secondary)] data-[state=active]:text-[var(--hive-background-primary)]", children: "Usage" }), _jsx(TabsTrigger, { value: "audience", className: "data-[state=active]:bg-[var(--hive-brand-secondary)] data-[state=active]:text-[var(--hive-background-primary)]", children: "Audience" }), _jsx(TabsTrigger, { value: "performance", className: "data-[state=active]:bg-[var(--hive-brand-secondary)] data-[state=active]:text-[var(--hive-background-primary)]", children: "Performance" })] }), _jsxs(TabsContent, { value: "overview", className: "space-y-6", children: [_jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6", children: [_jsx(MetricCard, { title: "Total Usage", value: analytics.overview.totalUsage, icon: Activity, change: 12.5 }), _jsx(MetricCard, { title: "Unique Users", value: analytics.overview.uniqueUsers, icon: Users, change: 8.3 }), _jsx(MetricCard, { title: "Avg Session", value: analytics.overview.averageSessionDuration, icon: Clock, format: "duration", change: -2.1 }), _jsx(MetricCard, { title: "Rating", value: analytics.overview.averageRating, icon: Star, change: 0.2 })] }), _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-6", children: [_jsx(MetricCard, { title: "Total Installations", value: analytics.overview.totalInstallations, icon: Download, change: 15.7 }), _jsx(MetricCard, { title: "Active Installations", value: analytics.overview.activeInstallations, icon: Zap, change: 10.2 }), _jsx(MetricCard, { title: "Conversion Rate", value: analytics.overview.conversionRate, icon: Target, format: "percentage", change: 2.3 })] }), _jsx(UsageChart, { data: analytics.usage.timeSeriesData })] }), _jsx(TabsContent, { value: "usage", className: "space-y-6", children: _jsxs("div", { className: "grid grid-cols-1 lg:grid-cols-2 gap-6", children: [_jsx(ActionBreakdownChart, { data: analytics.usage.topActions }), _jsx(TopSpacesTable, { data: analytics.usage.topSpaces })] }) }), _jsxs(TabsContent, { value: "audience", className: "space-y-6", children: [_jsxs("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-6", children: [_jsx(MetricCard, { title: "Sessions per User", value: analytics.audience.engagementMetrics.averageSessionsPerUser, icon: Activity }), _jsx(MetricCard, { title: "Time per Session", value: analytics.audience.engagementMetrics.averageTimePerSession, icon: Clock, format: "duration" }), _jsx(MetricCard, { title: "Bounce Rate", value: analytics.audience.engagementMetrics.bounceRate, icon: Eye, format: "percentage" })] }), _jsxs("div", { className: "grid grid-cols-1 lg:grid-cols-2 gap-6", children: [_jsx(RetentionChart, { data: analytics.audience.userRetention }), _jsx(UserTypeChart, { data: analytics.audience.demographics.byUserType })] }), _jsxs(Card, { className: "p-6 bg-[color-mix(in_srgb,var(--hive-interactive-hover)_40%,transparent)] border-[color-mix(in_srgb,var(--hive-interactive-active)_60%,transparent)]", children: [_jsx("h3", { className: "text-lg font-semibold text-[var(--hive-text-primary)] mb-6", children: "Top Institutions" }), _jsx("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: analytics.audience.demographics.byInstitution.slice(0, 8).map((institution, index) => (_jsxs("div", { className: "flex items-center justify-between p-3 bg-[color-mix(in_srgb,var(--hive-interactive-hover)_60%,transparent)] rounded-lg", children: [_jsx("span", { className: "text-[var(--hive-text-primary)]", children: institution.institution }), _jsxs("div", { className: "flex items-center gap-2", children: [_jsx("span", { className: "text-[var(--hive-text-tertiary)] text-sm", children: institution.count }), _jsxs(Badge, { variant: "outline", className: "border-[var(--hive-border-hover)]", children: [institution.percentage, "%"] })] })] }, institution.institution))) })] })] }), _jsxs(TabsContent, { value: "performance", className: "space-y-6", children: [_jsxs("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-6", children: [_jsx(MetricCard, { title: "Avg Load Time", value: analytics.performance.averageLoadTime, icon: Clock, format: "duration" }), _jsx(MetricCard, { title: "Error Rate", value: analytics.performance.errorRate, icon: Activity, format: "percentage" }), _jsx(MetricCard, { title: "Crash Rate", value: analytics.performance.crashRate, icon: Activity, format: "percentage" })] }), _jsxs(Card, { className: "p-6 bg-[color-mix(in_srgb,var(--hive-interactive-hover)_40%,transparent)] border-[color-mix(in_srgb,var(--hive-interactive-active)_60%,transparent)]", children: [_jsx("h3", { className: "text-lg font-semibold text-[var(--hive-text-primary)] mb-6", children: "Performance Insights" }), _jsxs("div", { className: "space-y-4", children: [_jsxs("div", { className: "flex items-center justify-between p-4 bg-[color-mix(in_srgb,var(--hive-interactive-hover)_60%,transparent)] rounded-lg", children: [_jsxs("div", { className: "flex items-center gap-3", children: [_jsx("div", { className: "w-2 h-2 bg-green-400 rounded-full" }), _jsx("span", { className: "text-[var(--hive-text-primary)]", children: "Tool loads quickly for most users" })] }), _jsx(Badge, { className: "bg-green-500/20 text-green-400 border-green-500/30", children: "Good" })] }), _jsxs("div", { className: "flex items-center justify-between p-4 bg-[color-mix(in_srgb,var(--hive-interactive-hover)_60%,transparent)] rounded-lg", children: [_jsxs("div", { className: "flex items-center gap-3", children: [_jsx("div", { className: "w-2 h-2 bg-yellow-400 rounded-full" }), _jsx("span", { className: "text-[var(--hive-text-primary)]", children: "Some API calls are slower than expected" })] }), _jsx(Badge, { className: "bg-yellow-500/20 text-yellow-400 border-yellow-500/30", children: "Fair" })] }), _jsxs("div", { className: "flex items-center justify-between p-4 bg-[color-mix(in_srgb,var(--hive-interactive-hover)_60%,transparent)] rounded-lg", children: [_jsxs("div", { className: "flex items-center gap-3", children: [_jsx("div", { className: "w-2 h-2 bg-red-400 rounded-full" }), _jsx("span", { className: "text-[var(--hive-text-primary)]", children: "Error rate increased by 0.3% this week" })] }), _jsx(Badge, { className: "bg-red-500/20 text-red-400 border-red-500/30", children: "Needs Attention" })] })] })] })] })] })] }));
};
export default ToolAnalyticsDashboard;
//# sourceMappingURL=tool-analytics-dashboard.js.map
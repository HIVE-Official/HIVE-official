"use client";
import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
/**
 * HIVE Tool Usage Tracker
 * Analytics and usage tracking for community tools
 */
import { useState, useMemo } from 'react';
import { HiveCard } from '../hive-card';
import { Button } from '../../atomic/atoms/button';
import { Badge } from '../../atomic/atoms/badge';
import { BarChart3, Users, Clock, Download, Star, Activity, AlertCircle, Award, Zap, Target, ArrowUp, ArrowDown, Minus } from 'lucide-react';
export const ToolUsageTracker = ({ tool, usageData, dateRange, onDateRangeChange, onExportData, userRole }) => {
    const [activeTab, setActiveTab] = useState('overview');
    // Calculate trends
    const trends = useMemo(() => {
        const { analytics } = usageData;
        const recent = analytics.dailyUsage.slice(-7);
        const previous = analytics.dailyUsage.slice(-14, -7);
        const recentTotal = recent.reduce((sum, day) => sum + day.sessions, 0);
        const previousTotal = previous.reduce((sum, day) => sum + day.sessions, 0);
        const sessionsTrend = previousTotal === 0 ? 0 : ((recentTotal - previousTotal) / previousTotal) * 100;
        const recentUsers = recent.reduce((sum, day) => sum + day.users, 0);
        const previousUsers = previous.reduce((sum, day) => sum + day.users, 0);
        const usersTrend = previousUsers === 0 ? 0 : ((recentUsers - previousUsers) / previousUsers) * 100;
        return {
            sessions: sessionsTrend,
            users: usersTrend,
            completion: analytics.completionRate,
            errors: analytics.errorRate
        };
    }, [usageData.analytics]);
    // Get trend icon and color
    const getTrendIndicator = (trend) => {
        if (trend > 5)
            return { icon: ArrowUp, color: 'text-green-500' };
        if (trend < -5)
            return { icon: ArrowDown, color: 'text-red-500' };
        return { icon: Minus, color: 'text-gray-500' };
    };
    // Format duration
    const formatDuration = (seconds) => {
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        if (minutes === 0)
            return `${remainingSeconds}s`;
        return `${minutes}m ${remainingSeconds}s`;
    };
    // Format percentage
    const formatPercentage = (value) => {
        return `${Math.round(value * 100) / 100}%`;
    };
    // Get rating stars
    const renderStars = (rating) => {
        const stars = [];
        const fullStars = Math.floor(rating);
        const hasHalfStar = rating % 1 !== 0;
        for (let i = 0; i < fullStars; i++) {
            stars.push(_jsx(Star, { className: "w-3 h-3 fill-yellow-400 text-yellow-400" }, i));
        }
        if (hasHalfStar) {
            stars.push(_jsx(Star, { className: "w-3 h-3 fill-yellow-400/50 text-yellow-400" }, "half"));
        }
        const emptyStars = 5 - Math.ceil(rating);
        for (let i = 0; i < emptyStars; i++) {
            stars.push(_jsx(Star, { className: "w-3 h-3 text-gray-400" }, `empty-${i}`));
        }
        return stars;
    };
    // Check permissions
    const canViewDetailedAnalytics = userRole === 'admin' || userRole === 'moderator';
    const canExportData = userRole === 'admin';
    return (_jsxs("div", { className: "space-y-6", children: [_jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { children: [_jsxs("h2", { className: "text-xl font-semibold text-[var(--hive-text-primary)] flex items-center space-x-2", children: [_jsx(BarChart3, { className: "w-5 h-5 text-[var(--hive-primary)]" }), _jsx("span", { children: "Usage Analytics" })] }), _jsxs("p", { className: "text-[var(--hive-text-secondary)] mt-1", children: ["Analytics for \"", tool.name, "\""] })] }), _jsxs("div", { className: "flex items-center space-x-2", children: [_jsxs("select", { value: dateRange, onChange: (e) => onDateRangeChange(e.target.value), className: "bg-[var(--hive-background-secondary)] border border-[var(--hive-border-default)] rounded-lg px-3 py-2 text-[var(--hive-text-primary)] text-sm focus:border-[var(--hive-primary)] focus:outline-none", children: [_jsx("option", { value: "7d", children: "Last 7 days" }), _jsx("option", { value: "30d", children: "Last 30 days" }), _jsx("option", { value: "90d", children: "Last 90 days" }), _jsx("option", { value: "1y", children: "Last year" })] }), canExportData && (_jsxs(Button, { variant: "outline", onClick: onExportData, children: [_jsx(Download, { className: "w-4 h-4 mr-2" }), "Export"] }))] })] }), _jsx("div", { className: "border-b border-[var(--hive-border-default)]", children: _jsx("div", { className: "flex space-x-6", children: [
                        { id: 'overview', label: 'Overview', icon: BarChart3 },
                        { id: 'sessions', label: 'Sessions', icon: Activity },
                        { id: 'users', label: 'Users', icon: Users },
                        { id: 'feedback', label: 'Feedback', icon: Star },
                        { id: 'performance', label: 'Performance', icon: Zap }
                    ].map(tab => {
                        const Icon = tab.icon;
                        return (_jsxs("button", { onClick: () => setActiveTab(tab.id), className: `flex items-center space-x-2 py-4 px-2 border-b-2 transition-colors ${activeTab === tab.id
                                ? 'border-[var(--hive-primary)] text-[var(--hive-primary)]'
                                : 'border-transparent text-[var(--hive-text-secondary)] hover:text-[var(--hive-text-primary)]'}`, children: [_jsx(Icon, { className: "w-4 h-4" }), _jsx("span", { className: "text-sm font-medium", children: tab.label })] }, tab.id));
                    }) }) }), _jsxs("div", { className: "space-y-6", children: [activeTab === 'overview' && (_jsxs("div", { className: "space-y-6", children: [_jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4", children: [_jsx(HiveCard, { className: "p-4", children: _jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { children: [_jsx("div", { className: "text-2xl font-bold text-[var(--hive-text-primary)]", children: usageData.analytics.totalSessions.toLocaleString() }), _jsx("div", { className: "text-sm text-[var(--hive-text-secondary)]", children: "Total Sessions" })] }), _jsx("div", { className: "flex items-center space-x-1", children: (() => {
                                                        const { icon: TrendIcon, color } = getTrendIndicator(trends.sessions);
                                                        return (_jsxs(_Fragment, { children: [_jsx(TrendIcon, { className: `w-4 h-4 ${color}` }), _jsxs("span", { className: `text-sm ${color}`, children: [Math.abs(trends.sessions).toFixed(1), "%"] })] }));
                                                    })() })] }) }), _jsx(HiveCard, { className: "p-4", children: _jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { children: [_jsx("div", { className: "text-2xl font-bold text-[var(--hive-text-primary)]", children: usageData.analytics.uniqueUsers.toLocaleString() }), _jsx("div", { className: "text-sm text-[var(--hive-text-secondary)]", children: "Unique Users" })] }), _jsx("div", { className: "flex items-center space-x-1", children: (() => {
                                                        const { icon: TrendIcon, color } = getTrendIndicator(trends.users);
                                                        return (_jsxs(_Fragment, { children: [_jsx(TrendIcon, { className: `w-4 h-4 ${color}` }), _jsxs("span", { className: `text-sm ${color}`, children: [Math.abs(trends.users).toFixed(1), "%"] })] }));
                                                    })() })] }) }), _jsx(HiveCard, { className: "p-4", children: _jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { children: [_jsx("div", { className: "text-2xl font-bold text-[var(--hive-text-primary)]", children: formatDuration(usageData.analytics.averageSessionTime) }), _jsx("div", { className: "text-sm text-[var(--hive-text-secondary)]", children: "Avg Session" })] }), _jsx(Clock, { className: "w-8 h-8 text-[var(--hive-primary)]" })] }) }), _jsx(HiveCard, { className: "p-4", children: _jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { children: [_jsx("div", { className: "text-2xl font-bold text-[var(--hive-text-primary)]", children: formatPercentage(usageData.analytics.completionRate) }), _jsx("div", { className: "text-sm text-[var(--hive-text-secondary)]", children: "Completion Rate" })] }), _jsx(Target, { className: "w-8 h-8 text-green-500" })] }) })] }), _jsxs(HiveCard, { className: "p-6", children: [_jsx("h3", { className: "text-lg font-semibold text-[var(--hive-text-primary)] mb-4", children: "Daily Usage Trend" }), _jsx("div", { className: "h-64 bg-[var(--hive-background-secondary)] rounded-lg flex items-center justify-center", children: _jsxs("div", { className: "text-center", children: [_jsx(BarChart3, { className: "w-12 h-12 text-[var(--hive-text-tertiary)] mx-auto mb-4" }), _jsx("p", { className: "text-[var(--hive-text-secondary)]", children: "Usage chart visualization would be implemented here" })] }) })] }), _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: [_jsxs(HiveCard, { className: "p-6", children: [_jsx("h3", { className: "text-lg font-semibold text-[var(--hive-text-primary)] mb-4", children: "Performance Insights" }), _jsxs("div", { className: "space-y-3", children: [_jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "text-[var(--hive-text-secondary)]", children: "Load Time" }), _jsxs("span", { className: "text-[var(--hive-text-primary)] font-medium", children: [usageData.performance.loadTime, "ms"] })] }), _jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "text-[var(--hive-text-secondary)]", children: "Error Rate" }), _jsx("span", { className: "text-[var(--hive-text-primary)] font-medium", children: formatPercentage(usageData.analytics.errorRate) })] }), _jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "text-[var(--hive-text-secondary)]", children: "Crashes" }), _jsx("span", { className: "text-[var(--hive-text-primary)] font-medium", children: usageData.performance.crashes })] })] })] }), _jsxs(HiveCard, { className: "p-6", children: [_jsx("h3", { className: "text-lg font-semibold text-[var(--hive-text-primary)] mb-4", children: "User Engagement" }), _jsxs("div", { className: "space-y-3", children: [_jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "text-[var(--hive-text-secondary)]", children: "Popularity Score" }), _jsxs("div", { className: "flex items-center space-x-2", children: [_jsx("div", { className: "flex", children: renderStars(usageData.analytics.popularityScore / 20) }), _jsx("span", { className: "text-[var(--hive-text-primary)] font-medium", children: (usageData.analytics.popularityScore / 20).toFixed(1) })] })] }), _jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "text-[var(--hive-text-secondary)]", children: "Feedback Count" }), _jsx("span", { className: "text-[var(--hive-text-primary)] font-medium", children: usageData.feedback.length })] }), _jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "text-[var(--hive-text-secondary)]", children: "Avg Rating" }), _jsx("span", { className: "text-[var(--hive-text-primary)] font-medium", children: usageData.feedback.length > 0
                                                                    ? (usageData.feedback.reduce((sum, f) => sum + f.rating, 0) / usageData.feedback.length).toFixed(1)
                                                                    : 'N/A' })] })] })] })] })] })), activeTab === 'sessions' && (_jsx("div", { className: "space-y-6", children: _jsxs(HiveCard, { className: "p-6", children: [_jsx("h3", { className: "text-lg font-semibold text-[var(--hive-text-primary)] mb-4", children: "Recent Sessions" }), canViewDetailedAnalytics ? (_jsxs("div", { className: "space-y-3", children: [usageData.sessions.slice(0, 10).map((session) => (_jsxs("div", { className: "flex items-center justify-between p-4 bg-[var(--hive-background-secondary)] rounded-lg", children: [_jsxs("div", { className: "flex items-center space-x-3", children: [_jsx("div", { className: "w-8 h-8 bg-[var(--hive-primary)]/20 rounded-full flex items-center justify-center", children: _jsx(Users, { className: "w-4 h-4 text-[var(--hive-primary)]" }) }), _jsxs("div", { children: [_jsx("p", { className: "font-medium text-[var(--hive-text-primary)]", children: session.userName }), _jsxs("p", { className: "text-sm text-[var(--hive-text-secondary)]", children: [new Date(session.startTime).toLocaleDateString(), " at ", new Date(session.startTime).toLocaleTimeString()] })] })] }), _jsx("div", { className: "flex items-center space-x-4", children: _jsxs("div", { className: "text-right", children: [_jsx("p", { className: "text-sm font-medium text-[var(--hive-text-primary)]", children: session.duration ? formatDuration(session.duration) : 'In progress' }), _jsx("div", { className: "flex items-center space-x-2", children: session.completedSuccessfully ? (_jsx(Badge, { variant: "secondary", className: "text-xs", children: "Completed" })) : session.errors && session.errors.length > 0 ? (_jsx(Badge, { variant: "error", className: "text-xs", children: "Error" })) : (_jsx(Badge, { variant: "secondary", className: "text-xs", children: "Incomplete" })) })] }) })] }, session.id))), usageData.sessions.length > 10 && (_jsx("div", { className: "text-center py-4", children: _jsx(Button, { variant: "outline", size: "sm", children: "Load More Sessions" }) }))] })) : (_jsxs("div", { className: "text-center py-8", children: [_jsx(AlertCircle, { className: "w-12 h-12 text-[var(--hive-text-tertiary)] mx-auto mb-4" }), _jsx("p", { className: "text-[var(--hive-text-secondary)]", children: "Detailed session data requires moderator or admin permissions." })] }))] }) })), activeTab === 'users' && (_jsx("div", { className: "space-y-6", children: _jsxs(HiveCard, { className: "p-6", children: [_jsx("h3", { className: "text-lg font-semibold text-[var(--hive-text-primary)] mb-4", children: "User Growth" }), canViewDetailedAnalytics ? (_jsx("div", { className: "space-y-4", children: usageData.analytics.userGrowth.map((period, index) => (_jsxs("div", { className: "flex items-center justify-between p-4 bg-[var(--hive-background-secondary)] rounded-lg", children: [_jsx("div", { children: _jsx("p", { className: "font-medium text-[var(--hive-text-primary)]", children: period.period }) }), _jsxs("div", { className: "flex items-center space-x-6", children: [_jsxs("div", { className: "text-center", children: [_jsxs("p", { className: "text-lg font-semibold text-green-500", children: ["+", period.newUsers] }), _jsx("p", { className: "text-xs text-[var(--hive-text-secondary)]", children: "New" })] }), _jsxs("div", { className: "text-center", children: [_jsx("p", { className: "text-lg font-semibold text-blue-500", children: period.returningUsers }), _jsx("p", { className: "text-xs text-[var(--hive-text-secondary)]", children: "Returning" })] })] })] }, index))) })) : (_jsxs("div", { className: "text-center py-8", children: [_jsx(AlertCircle, { className: "w-12 h-12 text-[var(--hive-text-tertiary)] mx-auto mb-4" }), _jsx("p", { className: "text-[var(--hive-text-secondary)]", children: "User analytics require moderator or admin permissions." })] }))] }) })), activeTab === 'feedback' && (_jsx("div", { className: "space-y-6", children: _jsxs(HiveCard, { className: "p-6", children: [_jsx("h3", { className: "text-lg font-semibold text-[var(--hive-text-primary)] mb-4", children: "User Feedback" }), usageData.feedback.length === 0 ? (_jsxs("div", { className: "text-center py-8", children: [_jsx(Star, { className: "w-12 h-12 text-[var(--hive-text-tertiary)] mx-auto mb-4" }), _jsx("p", { className: "text-[var(--hive-text-secondary)]", children: "No feedback received yet." })] })) : (_jsx("div", { className: "space-y-4", children: usageData.feedback.map((feedback) => (_jsxs("div", { className: "p-4 bg-[var(--hive-background-secondary)] rounded-lg", children: [_jsxs("div", { className: "flex items-start justify-between mb-3", children: [_jsxs("div", { className: "flex items-center space-x-3", children: [_jsx("div", { className: "w-8 h-8 bg-[var(--hive-primary)]/20 rounded-full flex items-center justify-center", children: _jsx(Users, { className: "w-4 h-4 text-[var(--hive-primary)]" }) }), _jsxs("div", { children: [_jsx("p", { className: "font-medium text-[var(--hive-text-primary)]", children: feedback.userName }), _jsx("p", { className: "text-sm text-[var(--hive-text-secondary)]", children: new Date(feedback.timestamp).toLocaleDateString() })] })] }), _jsx("div", { className: "flex items-center", children: renderStars(feedback.rating) })] }), feedback.comment && (_jsxs("p", { className: "text-[var(--hive-text-secondary)] text-sm", children: ["\"", feedback.comment, "\""] }))] }, feedback.id))) }))] }) })), activeTab === 'performance' && (_jsxs("div", { className: "space-y-6", children: [_jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: [_jsxs(HiveCard, { className: "p-6", children: [_jsx("h3", { className: "text-lg font-semibold text-[var(--hive-text-primary)] mb-4", children: "Response Times" }), _jsxs("div", { className: "space-y-3", children: [_jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "text-[var(--hive-text-secondary)]", children: "Load Time" }), _jsxs("span", { className: "text-[var(--hive-text-primary)] font-medium", children: [usageData.performance.loadTime, "ms"] })] }), _jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "text-[var(--hive-text-secondary)]", children: "Render Time" }), _jsxs("span", { className: "text-[var(--hive-text-primary)] font-medium", children: [usageData.performance.renderTime, "ms"] })] })] })] }), _jsxs(HiveCard, { className: "p-6", children: [_jsx("h3", { className: "text-lg font-semibold text-[var(--hive-text-primary)] mb-4", children: "Reliability" }), _jsxs("div", { className: "space-y-3", children: [_jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "text-[var(--hive-text-secondary)]", children: "Error Frequency" }), _jsxs("span", { className: "text-[var(--hive-text-primary)] font-medium", children: [usageData.performance.errorFrequency, "%"] })] }), _jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "text-[var(--hive-text-secondary)]", children: "Total Crashes" }), _jsx("span", { className: "text-[var(--hive-text-primary)] font-medium", children: usageData.performance.crashes })] })] })] })] }), _jsxs(HiveCard, { className: "p-6", children: [_jsxs("h3", { className: "text-lg font-semibold text-[var(--hive-text-primary)] mb-4 flex items-center", children: [_jsx(Award, { className: "w-5 h-5 text-[var(--hive-primary)] mr-2" }), "Performance Recommendations"] }), _jsxs("div", { className: "space-y-3", children: [usageData.performance.loadTime > 3000 && (_jsxs("div", { className: "flex items-start space-x-3 p-3 bg-orange-500/10 border border-orange-500/20 rounded-lg", children: [_jsx(AlertCircle, { className: "w-5 h-5 text-orange-500 mt-0.5" }), _jsxs("div", { children: [_jsx("p", { className: "text-sm font-medium text-[var(--hive-text-primary)]", children: "Slow Load Time" }), _jsx("p", { className: "text-sm text-[var(--hive-text-secondary)]", children: "Consider optimizing tool elements and reducing complexity to improve load times." })] })] })), usageData.analytics.completionRate < 0.7 && (_jsxs("div", { className: "flex items-start space-x-3 p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg", children: [_jsx(AlertCircle, { className: "w-5 h-5 text-yellow-500 mt-0.5" }), _jsxs("div", { children: [_jsx("p", { className: "text-sm font-medium text-[var(--hive-text-primary)]", children: "Low Completion Rate" }), _jsx("p", { className: "text-sm text-[var(--hive-text-secondary)]", children: "Users often don't complete the tool. Consider simplifying the workflow or adding guidance." })] })] })), usageData.performance.crashes > 5 && (_jsxs("div", { className: "flex items-start space-x-3 p-3 bg-red-500/10 border border-red-500/20 rounded-lg", children: [_jsx(AlertCircle, { className: "w-5 h-5 text-red-500 mt-0.5" }), _jsxs("div", { children: [_jsx("p", { className: "text-sm font-medium text-[var(--hive-text-primary)]", children: "Stability Issues" }), _jsx("p", { className: "text-sm text-[var(--hive-text-secondary)]", children: "Multiple crashes detected. Review tool logic and error handling." })] })] })), usageData.performance.loadTime <= 3000 && usageData.analytics.completionRate >= 0.7 && usageData.performance.crashes <= 5 && (_jsxs("div", { className: "flex items-start space-x-3 p-3 bg-green-500/10 border border-green-500/20 rounded-lg", children: [_jsx(Award, { className: "w-5 h-5 text-green-500 mt-0.5" }), _jsxs("div", { children: [_jsx("p", { className: "text-sm font-medium text-[var(--hive-text-primary)]", children: "Great Performance!" }), _jsx("p", { className: "text-sm text-[var(--hive-text-secondary)]", children: "Your tool is performing well with good load times, completion rates, and stability." })] })] }))] })] })] }))] })] }));
};
//# sourceMappingURL=tool-usage-tracker.js.map
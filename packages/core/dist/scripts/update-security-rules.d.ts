#!/usr/bin/env tsx
/**
 * Security Rules Enhancement Script
 *
 * This script generates additional security rules for the new collections
 * to be added to your existing firestore.rules file.
 *
 * Usage: pnpm tsx packages/core/src/scripts/update-security-rules.ts
 */
declare const newSecurityRules = "\n    // ======== RITUALS ========\n    \n    match /rituals/{ritualId} {\n      allow read: if isAuthenticated();\n      allow create, update, delete: if isAdmin();\n      \n      match /participants/{userId} {\n        allow read: if isAuthenticated();\n        allow create: if isAuthenticated() && request.auth.uid == userId;\n        allow update: if isAuthenticated() && request.auth.uid == userId;\n        allow delete: if isAdmin();\n      }\n      \n      match /analytics/{analyticsId} {\n        allow read: if isAdmin();\n        allow write: if isAdmin();\n      }\n    }\n    \n    match /ritual_announcements/{announcementId} {\n      allow read: if isAuthenticated();\n      allow write: if isAdmin();\n    }\n\n    // ======== NOTIFICATIONS ========\n    \n    match /notification_templates/{templateId} {\n      allow read: if isAdmin();\n      allow write: if isAdmin();\n    }\n    \n    match /notification_batches/{batchId} {\n      allow read: if isAdmin();\n      allow write: if isAdmin();\n    }\n    \n    // User notifications are handled in user subcollections above\n\n    // ======== TOOLS (Enhanced) ========\n    \n    match /tool_templates/{templateId} {\n      allow read: if isAuthenticated();\n      allow create: if isAuthenticated() && isVerified();\n      allow update, delete: if isAdmin() || \n                           resource.data.createdBy == request.auth.uid;\n    }\n    \n    // Tool usage tracking\n    match /tools/{toolId}/usage/{usageId} {\n      allow read: if isAdmin() || \n                 resource.data.userId == request.auth.uid ||\n                 exists(/databases/$(database)/documents/tools/$(toolId)) &&\n                 get(/databases/$(database)/documents/tools/$(toolId)).data.ownerId == request.auth.uid;\n      allow create: if isAuthenticated() && \n                   request.resource.data.userId == request.auth.uid;\n      allow update: if isAuthenticated() && \n                   resource.data.userId == request.auth.uid;\n      allow delete: if isAdmin();\n    }\n    \n    // Tool feedback\n    match /tools/{toolId}/feedback/{feedbackId} {\n      allow read: if isAuthenticated();\n      allow create: if isAuthenticated() && \n                   request.resource.data.userId == request.auth.uid;\n      allow update: if isAuthenticated() && \n                   resource.data.userId == request.auth.uid;\n      allow delete: if isAdmin() || \n                   resource.data.userId == request.auth.uid;\n    }\n\n    // ======== MODERATION ========\n    \n    match /content_reports/{reportId} {\n      allow read: if resource.data.reportedBy == request.auth.uid || \n                 isModerator() || isAdmin();\n      allow create: if isAuthenticated() && \n                   request.resource.data.reportedBy == request.auth.uid;\n      allow update: if isModerator() || isAdmin();\n      allow delete: if isAdmin();\n    }\n    \n    match /moderation_queue/{queueId} {\n      allow read, write: if isModerator() || isAdmin();\n    }\n    \n    match /moderation_action_logs/{logId} {\n      allow read: if isModerator() || isAdmin();\n      allow create: if isModerator() || isAdmin();\n      allow update, delete: if isAdmin();\n    }\n    \n    match /user_safety_records/{userId} {\n      allow read: if isModerator() || isAdmin() || \n                 request.auth.uid == userId;\n      allow write: if isModerator() || isAdmin();\n    }\n    \n    match /content_filter_rules/{ruleId} {\n      allow read: if isModerator() || isAdmin();\n      allow write: if isAdmin();\n    }\n\n    // ======== ANALYTICS (Enhanced) ========\n    \n    match /platform_analytics/{analyticsId} {\n      allow read: if isAdmin();\n      allow write: if isAdmin();\n    }\n    \n    match /analytics_events/{eventId} {\n      allow read: if isAdmin();\n      allow create: if isAuthenticated() && \n                   request.resource.data.userId == request.auth.uid;\n      allow update, delete: if isAdmin();\n    }\n\n    // ======== FILE UPLOADS ========\n    \n    match /file_uploads/{fileId} {\n      allow read: if resource.data.uploadedBy == request.auth.uid ||\n                 resource.data.visibility == 'public' ||\n                 (resource.data.visibility == 'authenticated' && isAuthenticated()) ||\n                 isAdmin();\n      allow create: if isAuthenticated() && \n                   request.resource.data.uploadedBy == request.auth.uid;\n      allow update: if resource.data.uploadedBy == request.auth.uid || isAdmin();\n      allow delete: if resource.data.uploadedBy == request.auth.uid || isAdmin();\n    }\n    \n    match /upload_sessions/{sessionId} {\n      allow read, write: if isAuthenticated() && \n                        request.auth.uid == resource.data.userId;\n    }\n    \n    match /file_access_logs/{logId} {\n      allow read: if isAdmin();\n      allow create: if true; // Allow creation for tracking\n      allow update, delete: if isAdmin();\n    }\n    \n    match /file_quotas/{userId} {\n      allow read: if request.auth.uid == userId || isAdmin();\n      allow write: if isAdmin();\n    }\n\n    // ======== SYSTEM CONFIGURATION ========\n    \n    match /system_settings/{settingId} {\n      allow read: if isAuthenticated();\n      allow write: if isAdmin();\n    }\n    \n    match /feature_flags/{flagId} {\n      allow read: if isAuthenticated();\n      allow write: if isAdmin();\n    }\n    \n    match /app_config/{configId} {\n      allow read: if true;\n      allow write: if isAdmin();\n    }\n";
declare const indexUpdates = "\n    // ======== NEW INDEXES FOR ENHANCED COLLECTIONS ========\n    \n    // Ritual indexes\n    {\n      \"collectionGroup\": \"rituals\",\n      \"queryScope\": \"COLLECTION\",\n      \"fields\": [\n        { \"fieldPath\": \"status\", \"order\": \"ASCENDING\" },\n        { \"fieldPath\": \"scheduledStart\", \"order\": \"ASCENDING\" }\n      ]\n    },\n    {\n      \"collectionGroup\": \"participants\",\n      \"queryScope\": \"COLLECTION_GROUP\",\n      \"fields\": [\n        { \"fieldPath\": \"ritualId\", \"order\": \"ASCENDING\" },\n        { \"fieldPath\": \"completedAt\", \"order\": \"DESCENDING\" }\n      ]\n    },\n    \n    // Tool usage indexes\n    {\n      \"collectionGroup\": \"usage\",\n      \"queryScope\": \"COLLECTION_GROUP\",\n      \"fields\": [\n        { \"fieldPath\": \"toolId\", \"order\": \"ASCENDING\" },\n        { \"fieldPath\": \"startTime\", \"order\": \"DESCENDING\" }\n      ]\n    },\n    {\n      \"collectionGroup\": \"feedback\",\n      \"queryScope\": \"COLLECTION_GROUP\",\n      \"fields\": [\n        { \"fieldPath\": \"toolId\", \"order\": \"ASCENDING\" },\n        { \"fieldPath\": \"rating\", \"order\": \"DESCENDING\" }\n      ]\n    },\n    \n    // Moderation indexes\n    {\n      \"collectionGroup\": \"content_reports\",\n      \"queryScope\": \"COLLECTION\",\n      \"fields\": [\n        { \"fieldPath\": \"status\", \"order\": \"ASCENDING\" },\n        { \"fieldPath\": \"priority\", \"order\": \"DESCENDING\" },\n        { \"fieldPath\": \"createdAt\", \"order\": \"DESCENDING\" }\n      ]\n    },\n    {\n      \"collectionGroup\": \"moderation_queue\",\n      \"queryScope\": \"COLLECTION\",\n      \"fields\": [\n        { \"fieldPath\": \"urgency\", \"order\": \"DESCENDING\" },\n        { \"fieldPath\": \"createdAt\", \"order\": \"ASCENDING\" }\n      ]\n    },\n    \n    // Analytics indexes\n    {\n      \"collectionGroup\": \"analytics_events\",\n      \"queryScope\": \"COLLECTION\",\n      \"fields\": [\n        { \"fieldPath\": \"userId\", \"order\": \"ASCENDING\" },\n        { \"fieldPath\": \"eventType\", \"order\": \"ASCENDING\" },\n        { \"fieldPath\": \"createdAt\", \"order\": \"DESCENDING\" }\n      ]\n    },\n    \n    // File upload indexes\n    {\n      \"collectionGroup\": \"file_uploads\",\n      \"queryScope\": \"COLLECTION\",\n      \"fields\": [\n        { \"fieldPath\": \"uploadedBy\", \"order\": \"ASCENDING\" },\n        { \"fieldPath\": \"purpose\", \"order\": \"ASCENDING\" },\n        { \"fieldPath\": \"createdAt\", \"order\": \"DESCENDING\" }\n      ]\n    }\n";
export { newSecurityRules, indexUpdates };
//# sourceMappingURL=update-security-rules.d.ts.map
# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

**Deadline**: December 9-13, 2025 ‚Äî Production launch at UB
**North Star**: Replace Instagram for campus content at University at Buffalo

---

## üéì PRODUCT UNDERSTANDING (Read This First)

### What HIVE Is

**HIVE is student infrastructure - a platform students build and own to organize campus life on their own terms.**

This isn't "Instagram for campus." This is **students taking back control** of the systems that shape their daily life. No waiting for universities to approve apps. No relying on corporations (Meta, TikTok) to understand campus needs. HIVE is what happens when students stop asking for permission and start building the future themselves.

**Core Insight**: Students shouldn't have to wait for institutions to give them the tools they need to organize, create, and move.

---

## üúÇ **Mission**

**To put the campus back in student hands.**

HIVE exists because students shouldn't have to wait for universities or corporations to build the platforms that shape their daily life. It's a living system ‚Äî built by students, for students ‚Äî that lets every campus run on its own rhythm and every idea find its own momentum.

---

## üúÅ **Vision**

**A generation that builds its own systems.**

Where the campus isn't managed from above but organized from within. Where creativity replaces compliance, and coordination becomes culture. HIVE imagines a future where students don't just use platforms ‚Äî they design them, evolve them, and make their university feel alive in real time.

---

## üúÉ **Philosophy**

* **Autonomy, not permission.** The future of student life isn't granted by policy ‚Äî it's built through initiative.
* **Ownership as identity.** The same people who live the culture should shape its tools.
* **Design over bureaucracy.** Systems should move as fast as students do ‚Äî simple, human, and built from the ground up.
* **Momentum through creation.** Every post, tool, or event isn't content ‚Äî it's proof that the campus can organize itself.
* **No waiting.** The age of waiting for "the official app" is over. HIVE *is* the official app ‚Äî because students made it so.

---

## üúÑ **Cultural Arc**

HIVE isn't a university product ‚Äî it's a **student revolution in infrastructure.**

It starts as an app, but it becomes a signal: that campuses can be self-sustaining, self-aware, and self-built. Every campus that joins isn't "onboarded" ‚Äî it's awakened.

**In one line**: *HIVE is the campus built by students ‚Äî the platform that proves we don't have to wait.*

---

### Why This Matters (The Tactical Reality)

**Students at University at Buffalo (UB) use Instagram to coordinate campus life** - finding events, joining clubs, meeting people, discovering campus resources. But Instagram was built for global audiences, not the 10,000-person community that is a college campus. And more importantly: **Instagram is owned by Meta, not by students.**

The problem isn't just that Instagram's algorithm shows global content. The problem is **students have no say in how their coordination infrastructure works.** They can't:
- Change the algorithm to prioritize campus events over celebrity posts
- Add custom tools (polls, RSVPs, resource sharing) to their club groups
- Create campus-wide moments (tournaments, challenges, rituals) that only their community participates in
- Build their profile around campus identity (major, clubs, contributions) instead of follower count

**HIVE solves this by giving students the tools to build their own campus infrastructure.** Not by asking Meta to change Instagram. Not by waiting for the university to approve an official app. But by **building it themselves and proving it works.**

### The Campus Problem

**Instagram/TikTok are broken for campus coordination:**

1. **Discovery is broken** - Students can't find campus events, clubs, or resources because Instagram's algorithm shows global content, not campus content.
2. **Identity is wrong** - Instagram profiles are optimized for influencers (follower count, aesthetics), not students (major, grad year, clubs, campus identity).
3. **Communities don't work** - Instagram groups are afterthoughts. Campus clubs need real coordination tools (event creation, polls, announcements, resources).
4. **No campus-wide moments** - Instagram can't create campus-wide behavioral campaigns (e.g., "Campus Madness" tournament bracket, "Founding 100" badge for early adopters).

**What students actually need:**
- **See what's happening on campus RIGHT NOW** (events tonight, club meetings, campus news)
- **Join communities that matter** (clubs, orgs, departments, friend groups)
- **Build campus identity** (major, grad year, clubs joined, campus contributions)
- **Coordinate group activities** (schedule meetings, create polls, share resources)
- **Participate in campus-wide events** (tournaments, challenges, exclusive unlocks)

HIVE solves these problems with 6 features built specifically for campus life.

---

### The 6 Launch Features (Why Each Exists)

#### 1Ô∏è‚É£ **Auth/Onboarding** - Campus Identity Gateway
**Problem**: Instagram lets anyone sign up. Campus apps need @edu verification to build trust and safety.

**What it does**:
- Requires @buffalo.edu email (campus-locked signup)
- 10-step onboarding wizard to build campus identity (name, handle, photo, major, grad year, interests)
- Creates trust: Everyone on HIVE goes to UB (no strangers, no bots, no creeps)

**Student benefit**: "I know everyone here is a UB student like me."

---

#### 2Ô∏è‚É£ **Feed** - Campus Discovery Stream
**Problem**: Instagram's feed is 90% global content (celebrities, brands, influencers). Students miss campus events because they're buried.

**What it does**:
- Aggregates ALL posts from spaces you've joined (clubs, orgs, departments)
- Read-only discovery stream (you post in spaces, not on Feed)
- Real-time updates every 30 seconds (see events as they're posted)
- Smart algorithm: Recency + engagement + space membership weighting

**Student behavior**:
- Open app ‚Üí See feed ‚Üí Upvote cool event ‚Üí Go back to class
- "What's happening on campus today?" ‚Üí Scroll feed ‚Üí Find event tonight ‚Üí Join space
- **Core loop is < 3 seconds**: Open ‚Üí Scan ‚Üí Engage ‚Üí Exit

**Why this is different from Instagram**:
- Instagram: Global algorithm shows you influencers/brands/celebrities
- HIVE: Campus algorithm shows you ONLY UB content from communities you've joined
- Result: 100% relevant, 0% noise

---

#### 3Ô∏è‚É£ **Spaces** - Community Hubs
**Problem**: Instagram groups are terrible for campus clubs. No event creation, no polls, no resource sharing, no roles/permissions.

**What it does**:
- Digital home for every campus community (clubs, orgs, departments, friend groups)
- Tools for coordination: Post announcements, create events, run polls, share files, deploy custom tools
- Pre-seeded from campus RSS feeds (auto-create spaces for every club/org at UB)
- Feed-first minimalism: Vertical scroll (like Instagram), not tab navigation
- Leader tools: Pin announcements, feature posts, manage members

**Student behavior**:
- Join "UB Dance Club" space ‚Üí See rehearsal schedule ‚Üí RSVP to event ‚Üí Get reminders
- Join "CS Department" space ‚Üí See job postings ‚Üí Upvote relevant ones ‚Üí Apply
- Join "Apartment Hunt Fall 2025" space ‚Üí See listings ‚Üí Comment on good ones ‚Üí Find roommates

**Why this is different from Instagram**:
- Instagram: DM groups with no structure, no roles, no tools
- HIVE: Spaces are mini-apps with event creation, polls, resources, custom tools
- Result: Actual coordination, not just chat

---

#### 4Ô∏è‚É£ **Profile** - Campus Identity
**Problem**: Instagram profiles are for influencers (follower count, aesthetic grid). Students need campus identity (major, clubs, contributions).

**What it does**:
- Bento grid layout with 6 customizable widgets:
  1. **Identity**: Name, handle, major, grad year, @buffalo.edu badge
  2. **Spaces**: Clubs/orgs you've joined (shows campus involvement)
  3. **Activity**: Recent posts, comments, upvotes (shows engagement)
  4. **Connections**: Campus connections (not "friends" - campus-appropriate term)
  5. **HiveLab**: Personal tools you've created (shows builder status)
  6. **Calendar**: Upcoming events from your spaces
- Completion psychology: "Your profile is 80% complete - Add your major!"
- Privacy controls: Ghost mode for course stalking protection

**Student behavior**:
- See someone's profile ‚Üí Check major ‚Üí See shared clubs ‚Üí Send connection request
- Edit profile ‚Üí Add major ‚Üí Upload photo ‚Üí Profile 100% complete ‚Üí Get completion badge
- Browse profiles ‚Üí See who's in your major ‚Üí Find study partners

**Why this is different from Instagram**:
- Instagram: Follower count, aesthetic grid, global audience
- HIVE: Campus identity, involvement, local community
- Result: Profiles show "Who are you on this campus?" not "How famous are you?"

---

#### 5Ô∏è‚É£ **HiveLab** - No-Code Builder
**Problem**: Campus clubs need custom tools (polls, sign-ups, schedules), but hiring developers is expensive. Instagram has zero customization.

**What it does**:
- No-code tool builder with drag-and-drop canvas
- 30+ element types: Input fields, buttons, displays, polls, schedules, sign-ups
- Deploy tools to any space with 1-click
- Template library: Pre-built tools for common use cases (event RSVP, anonymous feedback, room finder)
- Analytics: See who used the tool, what they submitted, response counts

**Student behavior**:
- Club leader: "We need an anonymous feedback form" ‚Üí Open HiveLab ‚Üí Drag input fields + submit button ‚Üí Deploy to space ‚Üí Collect responses
- RA: "We need a room booking tool" ‚Üí Browse templates ‚Üí Customize "Room Finder" ‚Üí Deploy to dorm space ‚Üí Track bookings
- Student org: "We need event RSVP with meal preferences" ‚Üí Build custom form ‚Üí Deploy ‚Üí See responses in real-time

**Why this is different from Instagram**:
- Instagram: Zero customization, no tools, no extensions
- HIVE: Every space can have custom tools built by students for students
- Result: Campus coordination gets 10x easier (no Google Forms, no external tools, everything in HIVE)

**The moat**: Once clubs build tools in HIVE, they can't leave. Instagram can't replicate this.

---

#### 6Ô∏è‚É£ **Rituals** - Campus-Wide Events
**Problem**: Instagram can't create campus-wide behavioral campaigns. Students want to participate in campus-wide moments, but there's no platform for it.

**What it does**:
- Campus-wide behavioral campaigns with 9 archetypes:
  1. **Tournament**: Campus Madness bracket (vote on matchups)
  2. **Feature Drop**: Limited-time unlock (new feature for 24h only)
  3. **Rule Inversion**: Temporary rule suspension (anonymous posting enabled for 1 hour)
  4. **Founding Class**: First-mover badges (first 100 users get special badge)
  5. **Launch Countdown**: Pre-launch hype (countdown timer before app launches)
  6. **Beta Lottery**: Random early access (enter lottery for exclusive access)
  7. **Unlock Challenge**: Group goals (entire campus works toward shared goal)
  8. **Survival**: Attrition competition (vote people out until 1 winner remains)
  9. **Leak**: Mystery reveals (clues released over time, submit guesses)
- Admin can create rituals in < 30 seconds using templates
- Gold ritual banner appears at top of Feed when active
- Real-time participation tracking, leaderboards, completion rewards

**Student behavior**:
- See "Campus Madness: Vote for Best Dining Hall" ritual banner ‚Üí Tap to open ‚Üí Vote on matchups ‚Üí See live results ‚Üí Come back to vote on next round
- See "Founding 100" ritual ‚Üí Join in first 24 hours ‚Üí Get exclusive badge ‚Üí Show badge on profile
- See "Unlock Challenge: 500 Posts to Unlock Anonymous Posting" ‚Üí Post to contribute ‚Üí Watch progress bar fill ‚Üí Celebrate when unlocked

**Why this is the MOAT**:
- Instagram/Facebook/TikTok: One-size-fits-all global platform
- HIVE: Campus-specific behavioral campaigns that create **campus-wide moments**
- Result: Students participate in something ONLY their campus is doing (creates loyalty, identity, FOMO)

**The insight**: Students want to feel part of something bigger than themselves on campus. Rituals create those moments. Instagram can't do this because they're global - they can't create "UB only" moments.

---

### Student Behavior Patterns (How Students Actually Use Campus Apps)

**Mobile-first reality**:
- 80% of usage is on phones (not desktop)
- Sessions are 30 seconds to 2 minutes (not 20-minute browsing sessions)
- Students check app between classes, while walking, waiting for food

**Core loop optimization**:
```
Open app ‚Üí See feed ‚Üí Maybe engage ‚Üí Come back
```
- This loop must be < 3 seconds end-to-end
- If it takes 5+ seconds, students go back to Instagram
- Every feature either makes this faster or gets deleted

**What students actually do**:
1. **Discovery**: "What's happening on campus today?" ‚Üí Open HIVE ‚Üí Scroll feed ‚Üí Find event ‚Üí Join space
2. **Coordination**: "When is club meeting?" ‚Üí Open space ‚Üí Check pinned post ‚Üí RSVP to event
3. **Social proof**: "Who else is going to this event?" ‚Üí See participant list ‚Üí Recognize 3 friends ‚Üí Decide to go
4. **Identity building**: "I want people to know I'm in Dance Club" ‚Üí Join space ‚Üí Profile shows "Member of UB Dance Club"
5. **FOMO**: See ritual banner ‚Üí "First 100 get exclusive badge" ‚Üí Join immediately ‚Üí Show badge on profile

**Why this matters for the AI**:
- Every feature must work on mobile (375px viewport)
- Loading states must be instant (< 1s or students close app)
- Interactions must be optimistic (< 16ms perceived latency)
- Error states must be clear ("Network error - Tap to retry")
- Empty states must guide next action ("No spaces joined - Browse Spaces")

---

### The Rituals Moat (Why This is Defensible)

**The problem with social platforms**: They're not defensible. Facebook/Instagram/TikTok are platforms, not communities. They have network effects, but no loyalty.

**HIVE's moat is Rituals**:
- Campus-specific behavioral campaigns that Instagram/Facebook can't replicate
- Once students participate in a ritual, they feel part of the campus community
- Creates **campus-wide moments** that only happen on HIVE
- Examples:
  - "Campus Madness" bracket: 2,000 UB students vote on best dining hall
  - "Founding 100": First 100 users get exclusive badge (status symbol on campus)
  - "Unlock Challenge": Entire campus works together to unlock anonymous posting

**Why Instagram can't copy this**:
- Instagram is global (1 billion users). They can't create "UB only" moments.
- HIVE is campus-specific (10,000 users at UB). We can create tight-knit community experiences.
- Result: Students feel **ownership** of HIVE ("This is OUR campus app") vs Instagram ("This is a global app I happen to use")

**The business insight**:
- Social platforms compete on network effects (more users = better product)
- HIVE competes on **community effects** (tighter community = better product)
- 10,000 engaged students at UB > 1 million disengaged users globally

---

### Why This Scales (Multi-Campus Expansion)

**Year 1 (2025)**: Launch at UB, prove the model
- 10,000 students, 500 active users in first month
- Validate: Do students prefer HIVE over Instagram for campus content?
- Metric: Daily active users, retention, ritual participation

**Year 2 (2026)**: Expand to 5 more campuses
- Target: Mid-size universities (10,000-30,000 students)
- Strategy: Seed with campus influencers (club leaders, RAs, orientation leaders)
- Each campus gets its own isolated instance (campus isolation enforced in code)

**Year 3-5 (2027-2029)**: Expand to 50+ campuses
- Campus expansion is 1-week effort (Firebase tenant + RSS seed + admin onboarding)
- Network effects kick in: "If you're not on HIVE, you're missing out on campus life"
- Defensibility: Once clubs build tools in HiveLab, they can't leave

**Revenue model (post-launch)**:
- Year 1: Free (focus on growth)
- Year 2: Premium spaces ($5/month for clubs - custom branding, analytics, priority support)
- Year 3: Campus partnerships (charge universities for official campus engagement platform)

**Why this works**:
- Instagram is too big to care about campus life
- HIVE is ONLY about campus life
- Result: HIVE becomes the OS for campus coordination

---

## üéØ Critical Context (Technical Implementation)

### The Core Loop (< 3 seconds end-to-end)
```
Open app ‚Üí See feed ‚Üí Maybe engage ‚Üí Come back
```

Every feature either makes this faster or gets deleted. No exceptions.

### 6 Core Features (Priority Order)
1. **Auth/Onboarding** - Campus identity gateway (@buffalo.edu validation)
2. **Feed** - Campus discovery stream (read-only aggregation from spaces)
3. **Spaces** - Community hubs where coordination happens
4. **Profile** - Campus identity with connections (not "friends")
5. **HiveLab** - No-code tool builder for leaders
6. **Rituals** - Campus-wide behavioral campaigns (the moat)

### Launch Checklist (December 9-13, 2025)
‚úÖ Sign up with @buffalo.edu
‚úÖ See feed immediately
‚úÖ Post text/photos in spaces
‚úÖ Browse/join spaces
‚úÖ View/edit profile
‚úÖ Join campus-wide ritual

Everything else is secondary.

---

## üìê UX/UI Architecture (Production-Grade)

### Authoritative Documentation
All UX/UI patterns and project guidance are documented in `/docs/`:

**Agent Instructions**:
- **[AGENTS.md](AGENTS.md)** - Web-first product direction, vertical slice priorities, auth patterns, campus vision

**Master Guide**:
- **[docs/UX-UI-TOPOLOGY.md](docs/UX-UI-TOPOLOGY.md)** - Platform-wide patterns, 11 scale-ready features
- **[docs/ux/NAVIGATION_TOPOLOGY.md](docs/ux/NAVIGATION_TOPOLOGY.md)** - Platform-wide navigation system, 48+ keyboard shortcuts

**Feature-Specific**:
- **[docs/ux/FEED_TOPOLOGY.md](docs/ux/FEED_TOPOLOGY.md)** - Campus discovery engine, read-only aggregation
- **[docs/ux/SPACES_TOPOLOGY.md](docs/ux/SPACES_TOPOLOGY.md)** - Community hubs, feed-first minimalism
- **[docs/ux/HIVELAB_TOOLS_TOPOLOGY.md](docs/ux/HIVELAB_TOOLS_TOPOLOGY.md)** - No-code builder, 8 scale patterns

**Quick Reference**:
- **[docs/ux/NAVIGATION_QUICK_REFERENCE.md](docs/ux/NAVIGATION_QUICK_REFERENCE.md)** - Keyboard shortcuts cheat sheet, route map, component locations

### Scale-Ready Patterns (SF/YC Quality)

**From Linear/Vercel**:
- Command Palette (`Cmd+K`) - Keyboard-first navigation
- Unified keyboard shortcuts - vim-style `j/k`, zero-mouse browsing
- Clean minimal UI with power-user efficiency

**From Figma**:
- Undo/Redo system - 50-action stack, < 50ms granular undo
- Real-time collaboration - Live cursors, presence, conflict resolution
- Canvas-based editing with property inspectors

**From Google Docs**:
- Autosave - Debounced 10s, non-blocking
- Version history - 50 versions, 30-day retention
- Session recovery - Browser crash protection

**From TikTok**:
- Virtualized infinite scroll - 60fps with 10,000+ posts
- Optimistic updates - < 16ms interactions
- Smart prefetching - Seamless content loading

**From Arc**:
- Personal analytics - Engagement insights, recommendations
- Progressive disclosure - Mobile parity without complexity
- Graceful handoff - Mobile ‚Üí desktop via QR code

### Performance Budgets (Production-Grade)

**Initial Load** (scale-ready):
```
Feed:            < 1s (cold), < 500ms (warm)
Space Board:     < 1s (cold), < 400ms (warm)
Profile:         < 800ms (cold), < 300ms (warm)
HiveLab:         < 800ms (100+ tools, virtualized)
Studio:          < 1.5s (lazy-loaded)
```

**Interactions** (optimistic updates):
```
Upvote/Comment:  < 16ms (60fps)
Post creation:   < 100ms UI update
Space join:      < 200ms UI update
Command palette: < 100ms open/search
Autosave:        < 200ms (debounced)
```

**Scroll Performance**:
```
Feed:            60fps with 10,000+ posts (virtualized)
HiveLab:         60fps with 200+ tools
Space Board:     60fps with 500+ posts
```

**Bundle Optimization**:
```
Initial:         < 800KB gzipped (code-split)
Feed page:       < 200KB (lazy-loaded)
HiveLab Studio:  < 400KB (lazy-loaded)
Total:           < 2MB (all pages)
```

**Core Web Vitals**:
```
LCP: < 2.5s
FID: < 100ms
CLS: < 0.1
```

---

## üöÄ Quick Start Commands

### Development
```bash
# Start dev server (all apps)
pnpm dev

# Start specific app
pnpm dev --filter=web

# Build for production (with memory optimization)
NODE_OPTIONS="--max-old-space-size=4096" pnpm build

# Build specific package
pnpm build --filter=@hive/ui
pnpm build --filter=@hive/core

# Build without linting (faster iteration)
NODE_OPTIONS="--max-old-space-size=4096" npx next build --no-lint
```

### Code Quality
```bash
# Type check everything
NODE_OPTIONS="--max-old-space-size=4096" pnpm typecheck

# Type check specific file
NODE_OPTIONS="--max-old-space-size=4096" npx tsc --noEmit --skipLibCheck <file-path>

# Lint (optimized for large codebase)
NODE_OPTIONS="--max-old-space-size=4096" pnpm lint

# Lint specific areas
pnpm lint:api          # API routes (max 20 warnings)
pnpm lint:components   # Components (max 160 warnings)
pnpm lint:hooks        # Hooks (max 10 warnings)
```

### Testing
```bash
# Unit tests
pnpm test
pnpm test:watch

# E2E tests (Playwright)
pnpm test:e2e
pnpm test:e2e:headed   # With browser UI

# Run all tests (CI)
pnpm test:ci
```

### Pre-Commit Checklist
```bash
NODE_OPTIONS="--max-old-space-size=4096" pnpm typecheck && \
NODE_OPTIONS="--max-old-space-size=4096" pnpm lint && \
pnpm test && \
NODE_OPTIONS="--max-old-space-size=4096" pnpm build
```

---

## üèóÔ∏è Architecture Overview

### Monorepo Structure (Turborepo + pnpm)
```
apps/
  web/              # Main Next.js 15.3.3 app (port 3000)
  admin/            # Admin dashboard (port 3001)

packages/
  ui/               # @hive/ui - Atomic design system (70+ components)
  core/             # @hive/core - DDD business logic
  firebase/         # @hive/firebase - Firebase integration
  auth-logic/       # @hive/auth-logic - Authentication
  hooks/            # @hive/hooks - Shared React hooks
  tokens/           # @hive/tokens - Design tokens + CSS variables
  validation/       # @hive/validation - Zod schemas
  analytics/        # @hive/analytics - Analytics tracking
```

### Build Order (Managed by Turborepo)
```
1. @hive/tokens      ‚Üí Design tokens (CSS variables)
2. @hive/firebase    ‚Üí Firebase initialization
3. @hive/core        ‚Üí Business logic + types
4. @hive/auth-logic  ‚Üí Authentication
5. @hive/validation  ‚Üí Validation schemas
6. @hive/hooks       ‚Üí React hooks
7. @hive/ui          ‚Üí UI components
8. apps/web          ‚Üí Main app
```

### Domain-Driven Design (packages/core)
```
packages/core/src/
‚îú‚îÄ‚îÄ domain/                  # Domain layer (business rules)
‚îÇ   ‚îú‚îÄ‚îÄ identity/           # User profiles, campus identity
‚îÇ   ‚îú‚îÄ‚îÄ spaces/             # Community spaces
‚îÇ   ‚îú‚îÄ‚îÄ rituals/            # Behavioral campaigns
‚îÇ   ‚îú‚îÄ‚îÄ feed/               # Discovery feed
‚îÇ   ‚îî‚îÄ‚îÄ analytics/          # Analytics events
‚îú‚îÄ‚îÄ application/            # Application services (use cases)
‚îú‚îÄ‚îÄ infrastructure/         # Firebase repos, external services
‚îú‚îÄ‚îÄ types/                  # Shared types
‚îî‚îÄ‚îÄ utils/                  # Utility functions
```

**Key DDD Patterns**:
- **Aggregates**: `profile.aggregate.ts`, `space.aggregate.ts`
- **Value Objects**: `ub-email.value.ts`, `handle.value.ts`
- **Domain Events**: `profile-created.event.ts`, `space-joined.event.ts`
- **Repositories**: `profile.repository.ts`, `space.repository.ts`

---

## üîê API Routes & Security

### Standard API Route Pattern
```typescript
// apps/web/src/app/api/[feature]/route.ts
import { withAuthAndErrors, getUserId, respond } from '@/lib/middleware';
import { z } from 'zod';

const requestSchema = z.object({
  name: z.string().min(1).max(100),
});

export const POST = withAuthAndErrors(async (request, context, respond) => {
  const userId = getUserId(request);
  const data = await parseJsonBody(request);

  // Validate input
  const validated = requestSchema.parse(data);

  // Business logic with campus isolation
  const result = await someService.create({
    ...validated,
    userId,
    campusId: 'ub-buffalo' // REQUIRED for all queries
  });

  return respond.created(result);
});
```

### What `withAuthAndErrors` Provides
- ‚úÖ JWT session validation from cookies
- ‚úÖ User authentication via Firebase Admin
- ‚úÖ Campus isolation enforcement (`campusId: 'ub-buffalo'`)
- ‚úÖ Error handling and formatting
- ‚úÖ Response formatting (success/created/error)
- ‚úÖ Rate limiting (60 req/min per IP)
- ‚úÖ Security headers + CSRF protection
- ‚úÖ Audit logging

### Response Format
```typescript
// Success responses
respond.success(data)      // 200 with data
respond.created(data)      // 201 with data
respond.noContent()        // 204 no data

// Error responses (handled automatically)
respond.badRequest(message)   // 400
respond.unauthorized(message) // 401
respond.forbidden(message)    // 403
respond.notFound(message)     // 404
respond.error(message)        // 500
```

### Firebase Query Pattern (MANDATORY)
```typescript
// ‚úÖ CORRECT: Campus-isolated query
const q = query(
  collection(db, 'spaces'),
  where('campusId', '==', 'ub-buffalo'), // REQUIRED
  where('isActive', '==', true)
);

// ‚ùå WRONG: Missing campus isolation
const q = query(
  collection(db, 'spaces'),
  where('isActive', '==', true)
); // WILL FAIL SECURITY REVIEW

// ‚úÖ Use secure query helpers
import { getSecureSpacesQuery } from '@/lib/secure-firebase-queries';
const result = await getSecureSpacesQuery({ filterType: 'student_org' });
```

---

## üí° UI Component Development

### Component Location Strategy
```
packages/ui/src/atomic/
‚îú‚îÄ‚îÄ atoms/           # Button, Input, Badge, Avatar
‚îú‚îÄ‚îÄ molecules/       # FormField, Card, SearchBar
‚îú‚îÄ‚îÄ organisms/       # ProfileCard, SpaceCard, FeedCard
‚îî‚îÄ‚îÄ templates/       # Page layouts
```

### Atomic Design Workflow
1. **Check if component exists** in `@hive/ui`
2. **Compose from existing** atoms/molecules if possible
3. **Only create new** if absolutely necessary
4. **Add Storybook story** for reusable components
5. **Follow Radix UI + shadcn/ui** patterns

### Import Pattern
```typescript
// ‚úÖ Always use package imports
import { Button, Input, Card } from '@hive/ui';
import { useAuth } from '@hive/auth-logic';
import { db, auth } from '@hive/firebase';
import type { User, Space } from '@hive/core';

// Type-only imports
import type { Profile } from '@hive/core';
```

### Styling Standards
- **Tailwind CSS only** - No custom CSS unless absolutely necessary
- **Design tokens** - Use `@hive/tokens` for colors, spacing, typography
- **Mobile-first** - `sm:`, `md:`, `lg:` breakpoints
- **Dark theme default** - High contrast, WCAG 2.1 AA compliant
- **Accessibility** - Keyboard navigation, screen reader support

### Animation Guidelines
- **Framer Motion** - Complex animations
- **CSS transitions** - Simple hover/focus states
- **Max 300ms** - Micro-interactions
- **Respect `prefers-reduced-motion`** - Disable for accessibility

---

## üé® Design System (Updated October 2024)

### Recent UX Refinements

**Spaces - Feed-First Minimalism**:
- Clutter reduction: 600px ‚Üí 280px vertical space (-53%)
- Pinned posts: Carousel ‚Üí Vertical stack (gold left border only)
- Composer: No avatar, consolidated [+ Add] dropdown
- Mobile: Tab bar ‚Üí Single scroll (Instagram-style)

**HiveLab - YC/SF Workflows**:
- Studio tabs: 5 ‚Üí 2 (-60% navigation overhead)
- Deploy form: 10 fields ‚Üí 2 visible (smart defaults)
- Element categories: 4 ‚Üí 2 (BUILD, RESULTS)
- Analytics: Dashboard ‚Üí Response viewer (counts + lists, no charts)

**Platform-Wide**:
- Command Palette (`Cmd+K`) - Universal search/actions
- Keyboard shortcuts - vim-style `j/k` navigation
- Virtualization - 60fps with 10,000+ items
- Optimistic updates - < 16ms perceived latency

### Design Tokens
```css
/* Colors */
--gold-start: #FFD700;
--gold-end: #FFA500;
--text-primary: rgba(255, 255, 255, 1);
--text-secondary: rgba(255, 255, 255, 0.7);
--text-tertiary: rgba(255, 255, 255, 0.5);

/* Typography */
--text-display: 28px/32px;
--text-title: 22px/26px;
--text-heading: 18px/22px;
--text-body: 14px/20px;
--text-caption: 12px/16px;

/* Radii */
--radius-xs: 6px;
--radius-sm: 10px;
--radius-md: 14px;
--radius-lg: 22px;

/* Motion */
--motion-instant: 120ms;
--motion-quick: 160ms;
--motion-standard: 240ms;
--ease-smooth: cubic-bezier(0.23, 1, 0.32, 1);
```

---

## üîç Common Development Tasks

### Adding New Features
1. **Check existing patterns** in codebase first
2. **Use @hive/ui components** (don't create new ones)
3. **Follow atomic design** - atoms ‚Üí molecules ‚Üí organisms
4. **Ensure campus isolation** in all Firebase queries
5. **Add loading/error states** - No blank screens
6. **Test on mobile viewport** - 80% of usage is mobile
7. **Add to Storybook** if reusable UI component
8. **Reference topology docs** for UX patterns

### Debugging Commands
```bash
# Type check specific file
NODE_OPTIONS="--max-old-space-size=4096" npx tsc --noEmit --skipLibCheck <file-path>

# Find all API routes with auth
grep -r "withAuthAndErrors" apps/web/src/app/api

# Find campus isolation patterns
grep -r "campusId.*ub-buffalo" apps/web/src

# Find domain aggregates
find packages/core/src/domain -name "*.aggregate.ts"

# Count API routes (149 total)
find apps/web/src/app/api -name "route.ts" | wc -l

# Analyze bundle size
pnpm build:analyze
```

### File Locations
```
UI components:     packages/ui/src/atomic/
Domain models:     packages/core/src/domain/
API routes:        apps/web/src/app/api/ (149 routes)
Page components:   apps/web/src/app/ (App Router)
Middleware:        apps/web/src/lib/middleware/
Storybook stories: packages/ui/src/stories/
UX/UI docs:        docs/ (topology files)
```

---

## ‚ö†Ô∏è Critical Warnings (NEVER BREAK THESE)

1. **NEVER** skip campus isolation (`campusId: 'ub-buffalo'`) in queries
2. **NEVER** create mocks or stubs - production only
3. **NEVER** use `any` type in TypeScript
4. **NEVER** bypass authentication in API routes
5. **ALWAYS** handle loading/error states
6. **ALWAYS** test on mobile viewport (80% usage)
7. **ALWAYS** use package imports (`@hive/ui`, `@hive/core`)
8. **ALWAYS** validate user input with Zod schemas
9. **ALWAYS** use `withAuthAndErrors` middleware for protected routes
10. **ALWAYS** reference topology docs before building UI

---

## üöÄ Deployment (November 5th Target)

### Vercel Deployment
```bash
# Deploy to production
vercel --prod

# Deploy preview
vercel

# Environment variables
vercel env add FIREBASE_PRIVATE_KEY production
```

### Build Status Requirements
- ‚úÖ TypeScript: 0 errors
- ‚úÖ ESLint: < 200 warnings total
- ‚úÖ Production build: Success
- ‚úÖ Bundle optimization: Complete
- ‚úÖ All tests passing: Required
- ‚úÖ Performance budgets met: Feed < 1s, interactions < 16ms

### Pre-Deployment Checklist
```bash
# 1. Type check
NODE_OPTIONS="--max-old-space-size=4096" pnpm typecheck

# 2. Lint
NODE_OPTIONS="--max-old-space-size=4096" pnpm lint

# 3. Tests
pnpm test

# 4. Build
NODE_OPTIONS="--max-old-space-size=4096" pnpm build

# 5. Verify critical paths
# - Sign up with @buffalo.edu
# - See feed immediately
# - Post in space
# - Browse/join spaces
# - View profile

# 6. Firebase indexes
pnpm indexes:deploy

# 7. Environment variables
vercel env ls
```

---

## üìö Additional Resources

### Documentation Hierarchy
1. **CLAUDE.md** (this file) - Quick reference, development commands
2. **[docs/UX-UI-TOPOLOGY.md](docs/UX-UI-TOPOLOGY.md)** - Authoritative platform patterns
3. **[docs/ux/SPACES_TOPOLOGY.md](docs/ux/SPACES_TOPOLOGY.md)** - Spaces feature spec
4. **[docs/ux/HIVELAB_TOOLS_TOPOLOGY.md](docs/ux/HIVELAB_TOOLS_TOPOLOGY.md)** - HiveLab feature spec
5. **[HIVE.md](HIVE.md)** - Product vision, student behavior, design philosophy

### When Building Features
1. **Read topology docs first** - UX/UI patterns are authoritative
2. **Check @hive/ui** - Reuse existing components
3. **Follow DDD patterns** - Domain models in `@hive/core`
4. **Test at scale** - Verify with 1,000+ items before shipping
5. **Measure performance** - Run `pnpm build:analyze` regularly

### Development Philosophy
- **Ship remarkable, not viable** - First version must create sharing urge
- **Production only** - No mocks, stubs, or "we'll fix later"
- **Behavior change focus** - Build new habits, not features
- **Distribution is design** - Sharing IS the product
- **Mobile-first reality** - 80% of usage is on phones

---

**Remember**: HIVE succeeds when students choose it over Instagram for campus content. Every line of code should make campus life easier, more fun, or more connected.

**Deadline**: November 5th, 2025 ‚Äî Ship remarkable, ship production-ready. üöÄ

#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ† HIVE Design System - PERFECTION ENFORCEMENT"
echo "=============================================="
echo "ğŸ¯ Maintaining 100% compliance | Zero errors | 10/10 maturity"
echo ""

# Check for hardcoded values in staged files
echo "ğŸ” Validating design system perfection..."

# Get staged files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(tsx?|jsx?)$' || true)

if [ -z "$STAGED_FILES" ]; then
    echo "âœ… No TypeScript/JavaScript files staged"
    echo "ğŸ† Design system perfection maintained"
    exit 0
fi

# Run hardcoded value detection on staged files only
if ! node scripts/check-staged-hardcoded.js; then
    echo ""
    echo "ğŸš¨ COMMIT BLOCKED: DESIGN SYSTEM VIOLATION!"
    echo "âŒ Hardcoded values detected - breaking 100% compliance"
    echo ""
    echo "ğŸ› ï¸  REQUIRED FIXES:"
    echo "   â€¢ Use semantic tokens: var(--hive-brand-secondary)"
    echo "   â€¢ Use color-mix for opacity: color-mix(in_srgb,var(--hive-brand-secondary)_30%,transparent)"
    echo "   â€¢ Use Tailwind spacing: p-4, m-6, gap-8"
    echo ""
    echo "ğŸ”§ Migration tools available:"
    echo "   node migrate-final-hex-colors.js"
    echo "   node migrate-remaining-rgba.js"
    echo "   node migrate-absolute-final.js"
    echo ""
    echo "ğŸ“š See DESIGN_SYSTEM_STANDARDS.md for guidelines"
    echo "ğŸ† MAINTAIN PERFECTION - NO COMPROMISES!"
    echo ""
    exit 1
fi

echo "âœ… Design system perfection validated!"

# Type checking
echo "ğŸ” Running TypeScript checks..."
if ! npm run type-check --silent; then
    echo "âŒ COMMIT BLOCKED: TypeScript errors found"
    exit 1
else
    echo "âœ… TypeScript checks passed"
fi

# Linting
echo "ğŸ” Running ESLint..."
if ! npm run lint --silent; then
    echo "âŒ COMMIT BLOCKED: ESLint errors found"
    exit 1
else
    echo "âœ… ESLint checks passed"
fi

echo ""
echo "ğŸ‰ All checks passed! Proceeding with commit..."
echo ""
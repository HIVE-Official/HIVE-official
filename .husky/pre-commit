#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "üîç Running code quality checks..."

# Run ESLint with strict rules
echo "Running ESLint..."
npx eslint . --max-warnings 0 || {
  echo "‚ùå ESLint check failed. Please fix the errors before committing."
  exit 1
}

# Run TypeScript type checking
echo "Running TypeScript checks..."
pnpm typecheck || {
  echo "‚ùå TypeScript check failed. Please fix type errors before committing."
  exit 1
}

# Run code complexity analysis
echo "Running code complexity analysis..."
pnpm analyze-code || {
  echo "‚ùå Code complexity check failed. Please simplify complex functions/components."
  exit 1
}

# Run test suite
echo "Running tests..."
pnpm test || {
  echo "‚ùå Tests failed. Please fix failing tests before committing."
  exit 1
}

# Check for forbidden patterns
echo "Checking for forbidden patterns..."
! git diff --cached | grep -E "console\.(log|debug)" || {
  echo "‚ùå Found console.log statements. Please remove them before committing."
  exit 1
}

! git diff --cached | grep -E "debugger;" || {
  echo "‚ùå Found debugger statements. Please remove them before committing."
  exit 1
}

! git diff --cached | grep -E "TODO:" || {
  echo "‚ö†Ô∏è Found TODO comments. Consider resolving them before committing."
}

# Check for large files
find . -type f -size +500k ! -path "./node_modules/*" ! -path "./.git/*" -exec ls -lh {} \; | {
  while read line; do
    echo "‚ö†Ô∏è Large file detected: $line"
  done
}

# Success message
echo "‚úÖ All checks passed! Proceeding with commit..." 